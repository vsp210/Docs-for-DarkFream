<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.0"/>
    <title>DarkFream.app API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../DarkFream.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;DarkFream</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#DarkFream">DarkFream</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DarkFream.__init__">DarkFream</a>
                        </li>
                        <li>
                                <a class="variable" href="#DarkFream.routes">routes</a>
                        </li>
                        <li>
                                <a class="variable" href="#DarkFream.static_handlers">static_handlers</a>
                        </li>
                        <li>
                                <a class="variable" href="#DarkFream.env">env</a>
                        </li>
                        <li>
                                <a class="variable" href="#DarkFream.admin">admin</a>
                        </li>
                        <li>
                                <a class="variable" href="#DarkFream.plugin_manager">plugin_manager</a>
                        </li>
                        <li>
                                <a class="variable" href="#DarkFream.plugin_config">plugin_config</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkFream.mount">mount</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkFream.load_plugins">load_plugins</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkFream.route">route</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkFream.route_404">route_404</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkFream.handle_request">handle_request</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkFream.render">render</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkFream.render_code">render_code</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkFream.cache_template">cache_template</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkFream.render_with_cache">render_with_cache</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkFream.redirect">redirect</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkFream.api_route">api_route</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkFream.api_handler">api_handler</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkFream.json_response">json_response</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkFream.run">run</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkFream.send_response">send_response</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DarkHandler">DarkHandler</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#DarkHandler.darkfream">darkfream</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkHandler.initialize">initialize</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkHandler.do_POST">do_POST</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkHandler.do_OPTIONS">do_OPTIONS</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkHandler.parse_session">parse_session</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkHandler.do_GET">do_GET</a>
                        </li>
                        <li>
                                <a class="function" href="#DarkHandler.log_message">log_message</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#migrate">migrate</a>
            </li>
    </ul>




</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../DarkFream.html">DarkFream</a><wbr>.app    </h1>


                        <input id="mod-app-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-app-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span> <span class="nn">json</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span> <span class="nn">re</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">http.server</span> <span class="kn">import</span> <span class="n">BaseHTTPRequestHandler</span><span class="p">,</span> <span class="n">HTTPServer</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">FileSystemLoader</span><span class="p">,</span> <span class="n">ChoiceLoader</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span> <span class="nn">urllib.parse</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">.core</span> <span class="kn">import</span> <span class="n">PluginConfig</span><span class="p">,</span> <span class="n">PluginManager</span><span class="p">,</span> <span class="n">Request</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span> <span class="nn">.admin</span> <span class="kn">import</span> <span class="n">DarkAdmin</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span> <span class="nn">.orm</span> <span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">Session</span><span class="p">,</span> <span class="n">conn</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="k">class</span> <span class="nc">DarkFream</span><span class="p">:</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Основной класс приложения DarkFream, который обрабатывает маршрутизацию и запросы.&quot;&quot;&quot;</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Инициализирует DarkFream с необходимыми компонентами, такими как маршруты и шаблоны.&quot;&quot;&quot;</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">routes</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">static_handlers</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>        <span class="n">framework_templates_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">&#39;templates&#39;</span><span class="p">)</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>        <span class="n">user_templates_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;templates&#39;</span><span class="p">)</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">ChoiceLoader</span><span class="p">([</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>            <span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">user_templates_dir</span><span class="p">),</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>            <span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">framework_templates_dir</span><span class="p">)</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>        <span class="p">]))</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s1">&#39;getattr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">admin</span> <span class="o">=</span> <span class="n">DarkAdmin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span> <span class="o">=</span> <span class="n">PluginManager</span><span class="p">()</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_config</span> <span class="o">=</span> <span class="n">PluginConfig</span><span class="p">()</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>    <span class="k">def</span> <span class="nf">mount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Подключает статический обработчик к указанному префиксу.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">        Args:</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">            prefix (str): Префикс URL, к которому будет подключен обработчик.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">            handler (callable): Обработчик, который будет вызываться для данного префикса.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">            name (str, optional): Имя обработчика. По умолчанию None.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">static_handlers</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="n">handler</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="k">def</span> <span class="nf">load_plugins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Загружает все включенные плагины и инициализирует их.&quot;&quot;&quot;</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>        <span class="k">for</span> <span class="n">plugin_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugin_config</span><span class="o">.</span><span class="n">enabled_plugins</span><span class="p">:</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>            <span class="n">plugin_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span><span class="o">.</span><span class="n">get_plugin</span><span class="p">(</span><span class="n">plugin_name</span><span class="p">)</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>            <span class="k">if</span> <span class="n">plugin_class</span><span class="p">:</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>                <span class="n">plugin</span> <span class="o">=</span> <span class="n">plugin_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>                <span class="n">plugin</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>    <span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]):</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Декоратор для регистрации маршрута.</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">        Args:</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">            path (str): Путь для маршрута.</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">            methods (list, optional): Список HTTP-методов, поддерживаемых маршрутом. По умолчанию [&#39;GET&#39;].</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        Returns:</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">            callable: Обернутый обработчик маршрута.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="n">path_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;([^&gt;]+)&gt;&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(?P&lt;\1&gt;[^/]+)&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="n">path_regex</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;^</span><span class="si">{</span><span class="n">path_regex</span><span class="si">}</span><span class="s1">$&#39;</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>            <span class="k">if</span> <span class="n">path_regex</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">:</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">path_regex</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>            <span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">path_regex</span><span class="p">][</span><span class="s1">&#39;*&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>                <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">path_regex</span><span class="p">][</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>            <span class="k">return</span> <span class="n">func</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="k">return</span> <span class="n">wrapper</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>    <span class="k">def</span> <span class="nf">route_404</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Регистрирует обработчик для маршрута 404.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">        Args:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">            func (callable): Обработчик, который будет вызван при отсутствии маршрута.</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">        Returns:</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">            callable: Обернутый обработчик маршрута 404.</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="s1">&#39;404&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="k">return</span> <span class="n">func</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Обрабатывает входящий HTTP-запрос.</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        Args:</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">            path (str): Путь запроса.</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">            method (str, optional): HTTP-метод запроса. По умолчанию &#39;GET&#39;.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">            data (dict, optional): Данные запроса. По умолчанию None.</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">        Returns:</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">            tuple: Кортеж, содержащий статус-код, тело ответа и тип контента.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>            <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>            <span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">:</span> <span class="s1">&#39;GET, POST, OPTIONS&#39;</span><span class="p">,</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>            <span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">:</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>            <span class="s1">&#39;Access-Control-Allow-Credentials&#39;</span><span class="p">:</span> <span class="s1">&#39;true&#39;</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="p">}</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>            <span class="k">return</span> <span class="mi">204</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">headers</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">methods</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>            <span class="k">if</span> <span class="n">match</span> <span class="ow">and</span> <span class="p">(</span><span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span> <span class="ow">or</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">):</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>                <span class="n">kwargs</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">methods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">methods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">))(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>                        <span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span><span class="p">,</span> <span class="n">content_type</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>                            <span class="n">content_type</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>                        <span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>                        <span class="n">content_type</span> <span class="o">=</span> <span class="s1">&#39;text/html&#39;</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid return value from route handler: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>                    <span class="n">status_code</span> <span class="o">=</span> <span class="mi">200</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>                    <span class="n">response_body</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>                    <span class="n">content_type</span> <span class="o">=</span> <span class="s1">&#39;text/html&#39;</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>                <span class="k">if</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s1">&#39;application/json&#39;</span><span class="p">:</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>                    <span class="k">return</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span><span class="p">,</span> <span class="n">content_type</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response_body</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>                    <span class="k">return</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span><span class="p">,</span> <span class="n">content_type</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response_body</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>                    <span class="n">context</span> <span class="o">=</span> <span class="n">response_body</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>                    <span class="k">if</span> <span class="s1">&#39;session&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>                        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;session&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>                    <span class="k">return</span> <span class="n">status_code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_with_cache</span><span class="p">(</span><span class="n">response_body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;admin/base.html&#39;</span><span class="p">),</span> <span class="n">context</span><span class="p">),</span> <span class="n">content_type</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="k">return</span> <span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;404 Not Found&quot;</span><span class="p">,</span> <span class="s1">&#39;text/html&#39;</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{}):</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Рендерит шаблон с заданным контекстом.</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">        Args:</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">            template_name (str): Имя шаблона для рендеринга.</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">            context (dict, optional): Контекст для шаблона. По умолчанию пустой словарь.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">        Returns:</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">            str: Содержимое отрендеренного шаблона.</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>    <span class="k">def</span> <span class="nf">render_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">template_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Рендерит ответ с заданным статусом и сообщением.</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">        Args:</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">            status_code (int): Код статуса HTTP.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">            message (str): Сообщение для отображения.</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">            template_name (str, optional): Имя шаблона для рендеринга. По умолчанию None.</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">            context (dict, optional): Контекст для шаблона. По умолчанию None.</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">        Returns:</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">            tuple: Кортеж, содержащий код статуса и сообщение, или отрендеренное содержимое.</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="k">if</span> <span class="n">template_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>            <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">status_code</span><span class="p">,</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>                       <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">}</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_with_cache</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">status_code</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>    <span class="k">def</span> <span class="nf">cache_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">):</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Кэширует шаблон для повторного использования.</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">        Args:</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">            template_name (str): Имя шаблона для кэширования.</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">        Returns:</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">            Template: Отрендеренный шаблон.</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_template_cache&#39;</span><span class="p">):</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_template_cache</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="k">if</span> <span class="n">template_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template_cache</span><span class="p">:</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_template_cache</span><span class="p">[</span><span class="n">template_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template_cache</span><span class="p">[</span><span class="n">template_name</span><span class="p">]</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>    <span class="k">def</span> <span class="nf">render_with_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{}):</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Рендерит шаблон с кэшированием.</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">        Args:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">            template_name (str): Имя шаблона для рендеринга.</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">            context (dict, optional): Контекст для шаблона. По умолчанию пустой словарь.</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">        Returns:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">            str: Содержимое отрендеренного шаблона.</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>    <span class="k">def</span> <span class="nf">redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">):</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Перенаправляет на указанный путь.</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">        Args:</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">            path (str): Путь для перенаправления.</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">            method (str, optional): HTTP-метод для перенаправления. По умолчанию &#39;GET&#39;.</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">        Returns:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">            tuple: Кортеж, содержащий код статуса, пустое тело и заголовки для перенаправления.</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>        <span class="k">return</span> <span class="p">(</span><span class="mi">302</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>            <span class="s1">&#39;Location&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>            <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html&#39;</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>        <span class="p">})</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>    <span class="k">def</span> <span class="nf">api_route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]):</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Декоратор для регистрации API маршрута.</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">        Args:</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">            path (str): Путь для API маршрута.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">            methods (list, optional): Список HTTP-методов, поддерживаемых маршрутом. По умолчанию [&#39;GET&#39;].</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">        Returns:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">            callable: Обернутый обработчик API маршрута.</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>            <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">:</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>            <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_handler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>            <span class="k">return</span> <span class="n">func</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="k">return</span> <span class="n">wrapper</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>    <span class="k">def</span> <span class="nf">api_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Обработчик для API маршрута, обрабатывающий ошибки.</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">        Args:</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">            func (callable): Обработчик API.</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">        Returns:</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">            callable: Обернутый обработчик с обработкой ошибок.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>                <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="k">return</span> <span class="n">wrapper</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>    <span class="k">def</span> <span class="nf">json_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Создает JSON-ответ с заданным статусом и данными.</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="sd">        Args:</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="sd">            status_code (int): Код статуса HTTP.</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="sd">            data (dict): Данные, которые будут включены в JSON-ответ.</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">        Returns:</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">            tuple: Кортеж, содержащий код статуса, JSON-строку и заголовки для ответа.</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="kn">import</span> <span class="nn">json</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="n">response_body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>            <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>            <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>            <span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">:</span> <span class="s1">&#39;GET, POST, OPTIONS&#39;</span><span class="p">,</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>            <span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">:</span> <span class="s1">&#39;Content-Type&#39;</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="p">}</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="k">return</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span><span class="p">,</span> <span class="n">headers</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_address</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">):</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Запускает HTTP сервер.</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">        Args:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">            server_address (str): Адрес сервера. По умолчанию пустая строка.</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">            port (int): Порт, на котором будет запущен сервер. По умолчанию 8000.</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_plugins</span><span class="p">()</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>            <span class="n">handler</span> <span class="o">=</span> <span class="n">get_handler</span><span class="p">()</span> <span class="ow">or</span> <span class="n">DarkHandler</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>            <span class="n">httpd</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">((</span><span class="n">server_address</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">handler</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Serving on port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>            <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Server stopped&#39;</span><span class="p">)</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">receive</span><span class="p">,</span> <span class="n">send</span><span class="p">):</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="n">request</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">receive</span><span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">send</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>                <span class="k">return</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">send_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">send</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>        <span class="k">await</span> <span class="n">send</span><span class="p">({</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;http.response.start&quot;</span><span class="p">,</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>            <span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="n">k</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">v</span><span class="o">.</span><span class="n">encode</span><span class="p">()]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;headers&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>        <span class="p">})</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>        <span class="k">await</span> <span class="n">send</span><span class="p">({</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;http.response.body&quot;</span><span class="p">,</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>            <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">)</span> <span class="k">else</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>        <span class="p">})</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="k">class</span> <span class="nc">DarkHandler</span><span class="p">(</span><span class="n">BaseHTTPRequestHandler</span><span class="p">):</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>    <span class="n">darkfream</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">darkfream</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Инициализирует DarkHandler с экземпляром DarkFream.</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">        Args:</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">            darkfream (DarkFream, optional): Экземпляр DarkFream. Если не указан, создается новый экземпляр.</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">        Returns:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">            DarkFream: Экземпляр DarkFream, используемый в обработчике.</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">darkfream</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>            <span class="k">if</span> <span class="n">darkfream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">darkfream</span> <span class="o">=</span> <span class="n">darkfream</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">darkfream</span> <span class="o">=</span> <span class="n">DarkFream</span><span class="p">()</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">darkfream</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>    <span class="k">def</span> <span class="nf">do_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Обрабатывает HTTP POST запрос.</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">        Читает данные из запроса, обрабатывает их и возвращает ответ клиенту.</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>            <span class="n">content_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">])</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>            <span class="n">post_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">content_length</span><span class="p">)</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>            <span class="n">content_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>            <span class="k">if</span> <span class="s1">&#39;application/json&#39;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>                <span class="kn">import</span> <span class="nn">json</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>                <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">post_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>                <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">parse_qs</span><span class="p">(</span><span class="n">post_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="n">request_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>                <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>                <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">),</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>                <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">parsed_data</span><span class="p">,</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>                <span class="s1">&#39;session&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_session</span><span class="p">()</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>            <span class="p">}</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>            <span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">content_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">request_data</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>                <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">content_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;Location&#39;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>                <span class="k">return</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="k">except</span> <span class="ne">ConnectionAbortedError</span><span class="p">:</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Client connection aborted&#39;</span><span class="p">)</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error handling POST request: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>    <span class="k">def</span> <span class="nf">do_OPTIONS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Обрабатывает HTTP OPTIONS запрос.</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        Возвращает заголовки, позволяющие клиентам узнать, какие методы поддерживаются сервером.</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">204</span><span class="p">)</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">,</span> <span class="s1">&#39;GET, POST, OPTIONS&#39;</span><span class="p">)</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Credentials&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error handling OPTIONS request: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>    <span class="k">def</span> <span class="nf">parse_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Парсит данные сессии из заголовка Cookie.</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">        Returns:</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">            dict: Данные сессии, если они существуют, иначе пустой словарь.</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="n">session_cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Cookie&#39;</span><span class="p">)</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        <span class="k">if</span> <span class="n">session_cookie</span><span class="p">:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>                <span class="n">session_data</span> <span class="o">=</span> <span class="n">session_cookie</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;session=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">session_data</span><span class="p">)</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>                <span class="k">pass</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Обрабатывает HTTP GET запрос.</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">        Возвращает ответ клиенту в зависимости от запрашиваемого ресурса.</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>            <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span><span class="o">.</span><span class="n">static_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>                    <span class="n">content</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">content_type</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">Request</span><span class="p">({</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">},</span> <span class="kc">None</span><span class="p">))</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>                    <span class="k">return</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>            <span class="n">request_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>                <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>                <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">),</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>                <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>                <span class="s1">&#39;session&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_session</span><span class="p">()</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>            <span class="p">}</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>            <span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">content_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">request_data</span><span class="p">)</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>                <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">content_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>                <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">content_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>        <span class="k">except</span> <span class="ne">ConnectionAbortedError</span><span class="p">:</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Client connection aborted&#39;</span><span class="p">)</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>    <span class="k">def</span> <span class="nf">log_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Логирует сообщения о запросах.</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="sd">        Args:</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a><span class="sd">            format (str): Формат сообщения.</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="sd">            *args: Дополнительные аргументы для форматирования сообщения.</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>        <span class="n">client_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X-Forwarded-For&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X-Real-IP&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">client_ip</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> - - [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">log_date_time_string</span><span class="p">()</span><span class="si">}</span><span class="s1">] - %s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">format</span> <span class="o">%</span> <span class="n">args</span><span class="p">))</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="kn">from</span> <span class="nn">.global_config</span> <span class="kn">import</span> <span class="n">get_user_model</span><span class="p">,</span> <span class="n">set_user_model</span><span class="p">,</span> <span class="n">get_handler</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a><span class="k">def</span> <span class="nf">migrate</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="p">[],</span> <span class="n">custom_user_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initial_admin_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Мигрирует модели базы данных и создает начального администратора.</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="sd">    Эта функция добавляет указанные модели в базу данных, настраивает пользовательскую модель пользователя,</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">    и создает начального администратора, если он еще не существует.</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">    Args:</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">        models (list, optional): Список моделей для миграции. По умолчанию пустой список.</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="sd">        custom_user_model (type, optional): Пользовательская модель пользователя, которая должна наследоваться от User.</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">        initial_admin_data (dict, optional): Данные для создания начального администратора. Должны включать &#39;username&#39; и &#39;password&#39;.</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">    Raises:</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">        ValueError: Если custom_user_model не наследуется от User.</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>    <span class="n">models</span> <span class="o">+=</span> <span class="p">[</span><span class="n">User</span> <span class="p">,</span> <span class="n">Session</span><span class="p">]</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>    <span class="k">if</span> <span class="n">custom_user_model</span><span class="p">:</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">custom_user_model</span><span class="p">,</span> <span class="n">User</span><span class="p">):</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Custom user model must inherit from User class&quot;</span><span class="p">)</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>        <span class="n">set_user_model</span><span class="p">(</span><span class="n">custom_user_model</span><span class="p">)</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting user model to:&quot;</span><span class="p">,</span> <span class="n">custom_user_model</span><span class="p">)</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>    <span class="n">user_model</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span> <span class="ow">or</span> <span class="n">User</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>    <span class="n">handler</span> <span class="o">=</span> <span class="n">get_handler</span><span class="p">()</span> <span class="ow">or</span> <span class="n">DarkHandler</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>    <span class="n">handler</span><span class="o">.</span><span class="n">darkfream</span><span class="o">.</span><span class="n">admin</span><span class="o">.</span><span class="n">register_model</span><span class="p">(</span><span class="n">user_model</span><span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Migrate user model:&quot;</span><span class="p">,</span> <span class="n">user_model</span><span class="p">)</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>    <span class="n">default_admin</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="s1">&#39;is_admin&#39;</span><span class="p">:</span> <span class="kc">True</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>    <span class="p">}</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>    <span class="k">if</span> <span class="n">initial_admin_data</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">initial_admin_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>        <span class="n">initial_admin_data</span><span class="p">[</span><span class="s1">&#39;is_admin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>        <span class="k">if</span> <span class="s1">&#39;password&#39;</span> <span class="ow">in</span> <span class="n">initial_admin_data</span><span class="p">:</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>            <span class="n">password</span> <span class="o">=</span> <span class="n">initial_admin_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>            <span class="n">default_admin</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">initial_admin_data</span><span class="p">)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>            <span class="n">default_admin</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">password</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>            <span class="n">default_admin</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">initial_admin_data</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>    <span class="n">conn</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>    <span class="n">conn</span><span class="o">.</span><span class="n">create_tables</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_model</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>            <span class="n">default_admin</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_model</span><span class="o">.</span><span class="n">hash_password</span><span class="p">(</span><span class="n">default_admin</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>            <span class="n">user_model</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">default_admin</span><span class="p">)</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created admin user: </span><span class="si">{</span><span class="n">default_admin</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating admin user: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>        <span class="k">raise</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>    <span class="k">finally</span><span class="p">:</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="DarkFream">
                            <input id="DarkFream-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">

    <span class="def">class</span>
    <span class="name">DarkFream</span>:

                <label class="view-source-button" for="DarkFream-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream-17"><a href="#DarkFream-17"><span class="linenos"> 17</span></a><span class="k">class</span> <span class="nc">DarkFream</span><span class="p">:</span>
</span><span id="DarkFream-18"><a href="#DarkFream-18"><span class="linenos"> 18</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Основной класс приложения DarkFream, который обрабатывает маршрутизацию и запросы.&quot;&quot;&quot;</span>
</span><span id="DarkFream-19"><a href="#DarkFream-19"><span class="linenos"> 19</span></a>
</span><span id="DarkFream-20"><a href="#DarkFream-20"><span class="linenos"> 20</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DarkFream-21"><a href="#DarkFream-21"><span class="linenos"> 21</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Инициализирует DarkFream с необходимыми компонентами, такими как маршруты и шаблоны.&quot;&quot;&quot;</span>
</span><span id="DarkFream-22"><a href="#DarkFream-22"><span class="linenos"> 22</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">routes</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DarkFream-23"><a href="#DarkFream-23"><span class="linenos"> 23</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">static_handlers</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DarkFream-24"><a href="#DarkFream-24"><span class="linenos"> 24</span></a>        <span class="n">framework_templates_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">&#39;templates&#39;</span><span class="p">)</span>
</span><span id="DarkFream-25"><a href="#DarkFream-25"><span class="linenos"> 25</span></a>        <span class="n">user_templates_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;templates&#39;</span><span class="p">)</span>
</span><span id="DarkFream-26"><a href="#DarkFream-26"><span class="linenos"> 26</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">ChoiceLoader</span><span class="p">([</span>
</span><span id="DarkFream-27"><a href="#DarkFream-27"><span class="linenos"> 27</span></a>            <span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">user_templates_dir</span><span class="p">),</span>
</span><span id="DarkFream-28"><a href="#DarkFream-28"><span class="linenos"> 28</span></a>            <span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">framework_templates_dir</span><span class="p">)</span>
</span><span id="DarkFream-29"><a href="#DarkFream-29"><span class="linenos"> 29</span></a>        <span class="p">]))</span>
</span><span id="DarkFream-30"><a href="#DarkFream-30"><span class="linenos"> 30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s1">&#39;getattr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span>
</span><span id="DarkFream-31"><a href="#DarkFream-31"><span class="linenos"> 31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">admin</span> <span class="o">=</span> <span class="n">DarkAdmin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="DarkFream-32"><a href="#DarkFream-32"><span class="linenos"> 32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span> <span class="o">=</span> <span class="n">PluginManager</span><span class="p">()</span>
</span><span id="DarkFream-33"><a href="#DarkFream-33"><span class="linenos"> 33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_config</span> <span class="o">=</span> <span class="n">PluginConfig</span><span class="p">()</span>
</span><span id="DarkFream-34"><a href="#DarkFream-34"><span class="linenos"> 34</span></a>
</span><span id="DarkFream-35"><a href="#DarkFream-35"><span class="linenos"> 35</span></a>    <span class="k">def</span> <span class="nf">mount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DarkFream-36"><a href="#DarkFream-36"><span class="linenos"> 36</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Подключает статический обработчик к указанному префиксу.</span>
</span><span id="DarkFream-37"><a href="#DarkFream-37"><span class="linenos"> 37</span></a>
</span><span id="DarkFream-38"><a href="#DarkFream-38"><span class="linenos"> 38</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream-39"><a href="#DarkFream-39"><span class="linenos"> 39</span></a><span class="sd">            prefix (str): Префикс URL, к которому будет подключен обработчик.</span>
</span><span id="DarkFream-40"><a href="#DarkFream-40"><span class="linenos"> 40</span></a><span class="sd">            handler (callable): Обработчик, который будет вызываться для данного префикса.</span>
</span><span id="DarkFream-41"><a href="#DarkFream-41"><span class="linenos"> 41</span></a><span class="sd">            name (str, optional): Имя обработчика. По умолчанию None.</span>
</span><span id="DarkFream-42"><a href="#DarkFream-42"><span class="linenos"> 42</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream-43"><a href="#DarkFream-43"><span class="linenos"> 43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">static_handlers</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="n">handler</span>
</span><span id="DarkFream-44"><a href="#DarkFream-44"><span class="linenos"> 44</span></a>
</span><span id="DarkFream-45"><a href="#DarkFream-45"><span class="linenos"> 45</span></a>    <span class="k">def</span> <span class="nf">load_plugins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DarkFream-46"><a href="#DarkFream-46"><span class="linenos"> 46</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Загружает все включенные плагины и инициализирует их.&quot;&quot;&quot;</span>
</span><span id="DarkFream-47"><a href="#DarkFream-47"><span class="linenos"> 47</span></a>        <span class="k">for</span> <span class="n">plugin_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugin_config</span><span class="o">.</span><span class="n">enabled_plugins</span><span class="p">:</span>
</span><span id="DarkFream-48"><a href="#DarkFream-48"><span class="linenos"> 48</span></a>            <span class="n">plugin_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span><span class="o">.</span><span class="n">get_plugin</span><span class="p">(</span><span class="n">plugin_name</span><span class="p">)</span>
</span><span id="DarkFream-49"><a href="#DarkFream-49"><span class="linenos"> 49</span></a>            <span class="k">if</span> <span class="n">plugin_class</span><span class="p">:</span>
</span><span id="DarkFream-50"><a href="#DarkFream-50"><span class="linenos"> 50</span></a>                <span class="n">plugin</span> <span class="o">=</span> <span class="n">plugin_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="DarkFream-51"><a href="#DarkFream-51"><span class="linenos"> 51</span></a>                <span class="n">plugin</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="DarkFream-52"><a href="#DarkFream-52"><span class="linenos"> 52</span></a>
</span><span id="DarkFream-53"><a href="#DarkFream-53"><span class="linenos"> 53</span></a>    <span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]):</span>
</span><span id="DarkFream-54"><a href="#DarkFream-54"><span class="linenos"> 54</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Декоратор для регистрации маршрута.</span>
</span><span id="DarkFream-55"><a href="#DarkFream-55"><span class="linenos"> 55</span></a>
</span><span id="DarkFream-56"><a href="#DarkFream-56"><span class="linenos"> 56</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream-57"><a href="#DarkFream-57"><span class="linenos"> 57</span></a><span class="sd">            path (str): Путь для маршрута.</span>
</span><span id="DarkFream-58"><a href="#DarkFream-58"><span class="linenos"> 58</span></a><span class="sd">            methods (list, optional): Список HTTP-методов, поддерживаемых маршрутом. По умолчанию [&#39;GET&#39;].</span>
</span><span id="DarkFream-59"><a href="#DarkFream-59"><span class="linenos"> 59</span></a>
</span><span id="DarkFream-60"><a href="#DarkFream-60"><span class="linenos"> 60</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream-61"><a href="#DarkFream-61"><span class="linenos"> 61</span></a><span class="sd">            callable: Обернутый обработчик маршрута.</span>
</span><span id="DarkFream-62"><a href="#DarkFream-62"><span class="linenos"> 62</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream-63"><a href="#DarkFream-63"><span class="linenos"> 63</span></a>        <span class="n">path_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;([^&gt;]+)&gt;&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(?P&lt;\1&gt;[^/]+)&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="DarkFream-64"><a href="#DarkFream-64"><span class="linenos"> 64</span></a>        <span class="n">path_regex</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;^</span><span class="si">{</span><span class="n">path_regex</span><span class="si">}</span><span class="s1">$&#39;</span>
</span><span id="DarkFream-65"><a href="#DarkFream-65"><span class="linenos"> 65</span></a>
</span><span id="DarkFream-66"><a href="#DarkFream-66"><span class="linenos"> 66</span></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="DarkFream-67"><a href="#DarkFream-67"><span class="linenos"> 67</span></a>            <span class="k">if</span> <span class="n">path_regex</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">:</span>
</span><span id="DarkFream-68"><a href="#DarkFream-68"><span class="linenos"> 68</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">path_regex</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DarkFream-69"><a href="#DarkFream-69"><span class="linenos"> 69</span></a>
</span><span id="DarkFream-70"><a href="#DarkFream-70"><span class="linenos"> 70</span></a>            <span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
</span><span id="DarkFream-71"><a href="#DarkFream-71"><span class="linenos"> 71</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">path_regex</span><span class="p">][</span><span class="s1">&#39;*&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="DarkFream-72"><a href="#DarkFream-72"><span class="linenos"> 72</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DarkFream-73"><a href="#DarkFream-73"><span class="linenos"> 73</span></a>                <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
</span><span id="DarkFream-74"><a href="#DarkFream-74"><span class="linenos"> 74</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">path_regex</span><span class="p">][</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="DarkFream-75"><a href="#DarkFream-75"><span class="linenos"> 75</span></a>
</span><span id="DarkFream-76"><a href="#DarkFream-76"><span class="linenos"> 76</span></a>            <span class="k">return</span> <span class="n">func</span>
</span><span id="DarkFream-77"><a href="#DarkFream-77"><span class="linenos"> 77</span></a>        <span class="k">return</span> <span class="n">wrapper</span>
</span><span id="DarkFream-78"><a href="#DarkFream-78"><span class="linenos"> 78</span></a>
</span><span id="DarkFream-79"><a href="#DarkFream-79"><span class="linenos"> 79</span></a>    <span class="k">def</span> <span class="nf">route_404</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
</span><span id="DarkFream-80"><a href="#DarkFream-80"><span class="linenos"> 80</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Регистрирует обработчик для маршрута 404.</span>
</span><span id="DarkFream-81"><a href="#DarkFream-81"><span class="linenos"> 81</span></a>
</span><span id="DarkFream-82"><a href="#DarkFream-82"><span class="linenos"> 82</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream-83"><a href="#DarkFream-83"><span class="linenos"> 83</span></a><span class="sd">            func (callable): Обработчик, который будет вызван при отсутствии маршрута.</span>
</span><span id="DarkFream-84"><a href="#DarkFream-84"><span class="linenos"> 84</span></a>
</span><span id="DarkFream-85"><a href="#DarkFream-85"><span class="linenos"> 85</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream-86"><a href="#DarkFream-86"><span class="linenos"> 86</span></a><span class="sd">            callable: Обернутый обработчик маршрута 404.</span>
</span><span id="DarkFream-87"><a href="#DarkFream-87"><span class="linenos"> 87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream-88"><a href="#DarkFream-88"><span class="linenos"> 88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="s1">&#39;404&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="DarkFream-89"><a href="#DarkFream-89"><span class="linenos"> 89</span></a>        <span class="k">return</span> <span class="n">func</span>
</span><span id="DarkFream-90"><a href="#DarkFream-90"><span class="linenos"> 90</span></a>
</span><span id="DarkFream-91"><a href="#DarkFream-91"><span class="linenos"> 91</span></a>    <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DarkFream-92"><a href="#DarkFream-92"><span class="linenos"> 92</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Обрабатывает входящий HTTP-запрос.</span>
</span><span id="DarkFream-93"><a href="#DarkFream-93"><span class="linenos"> 93</span></a>
</span><span id="DarkFream-94"><a href="#DarkFream-94"><span class="linenos"> 94</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream-95"><a href="#DarkFream-95"><span class="linenos"> 95</span></a><span class="sd">            path (str): Путь запроса.</span>
</span><span id="DarkFream-96"><a href="#DarkFream-96"><span class="linenos"> 96</span></a><span class="sd">            method (str, optional): HTTP-метод запроса. По умолчанию &#39;GET&#39;.</span>
</span><span id="DarkFream-97"><a href="#DarkFream-97"><span class="linenos"> 97</span></a><span class="sd">            data (dict, optional): Данные запроса. По умолчанию None.</span>
</span><span id="DarkFream-98"><a href="#DarkFream-98"><span class="linenos"> 98</span></a>
</span><span id="DarkFream-99"><a href="#DarkFream-99"><span class="linenos"> 99</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream-100"><a href="#DarkFream-100"><span class="linenos">100</span></a><span class="sd">            tuple: Кортеж, содержащий статус-код, тело ответа и тип контента.</span>
</span><span id="DarkFream-101"><a href="#DarkFream-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream-102"><a href="#DarkFream-102"><span class="linenos">102</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DarkFream-103"><a href="#DarkFream-103"><span class="linenos">103</span></a>            <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span><span id="DarkFream-104"><a href="#DarkFream-104"><span class="linenos">104</span></a>            <span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">:</span> <span class="s1">&#39;GET, POST, OPTIONS&#39;</span><span class="p">,</span>
</span><span id="DarkFream-105"><a href="#DarkFream-105"><span class="linenos">105</span></a>            <span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">:</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span>
</span><span id="DarkFream-106"><a href="#DarkFream-106"><span class="linenos">106</span></a>            <span class="s1">&#39;Access-Control-Allow-Credentials&#39;</span><span class="p">:</span> <span class="s1">&#39;true&#39;</span>
</span><span id="DarkFream-107"><a href="#DarkFream-107"><span class="linenos">107</span></a>        <span class="p">}</span>
</span><span id="DarkFream-108"><a href="#DarkFream-108"><span class="linenos">108</span></a>
</span><span id="DarkFream-109"><a href="#DarkFream-109"><span class="linenos">109</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span>
</span><span id="DarkFream-110"><a href="#DarkFream-110"><span class="linenos">110</span></a>            <span class="k">return</span> <span class="mi">204</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">headers</span>
</span><span id="DarkFream-111"><a href="#DarkFream-111"><span class="linenos">111</span></a>
</span><span id="DarkFream-112"><a href="#DarkFream-112"><span class="linenos">112</span></a>        <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">methods</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DarkFream-113"><a href="#DarkFream-113"><span class="linenos">113</span></a>            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="DarkFream-114"><a href="#DarkFream-114"><span class="linenos">114</span></a>            <span class="k">if</span> <span class="n">match</span> <span class="ow">and</span> <span class="p">(</span><span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span> <span class="ow">or</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">):</span>
</span><span id="DarkFream-115"><a href="#DarkFream-115"><span class="linenos">115</span></a>                <span class="n">kwargs</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
</span><span id="DarkFream-116"><a href="#DarkFream-116"><span class="linenos">116</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">methods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">methods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">))(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="DarkFream-117"><a href="#DarkFream-117"><span class="linenos">117</span></a>
</span><span id="DarkFream-118"><a href="#DarkFream-118"><span class="linenos">118</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="DarkFream-119"><a href="#DarkFream-119"><span class="linenos">119</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="DarkFream-120"><a href="#DarkFream-120"><span class="linenos">120</span></a>                        <span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span><span class="p">,</span> <span class="n">content_type</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="DarkFream-121"><a href="#DarkFream-121"><span class="linenos">121</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DarkFream-122"><a href="#DarkFream-122"><span class="linenos">122</span></a>                            <span class="n">content_type</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
</span><span id="DarkFream-123"><a href="#DarkFream-123"><span class="linenos">123</span></a>                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="DarkFream-124"><a href="#DarkFream-124"><span class="linenos">124</span></a>                        <span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="DarkFream-125"><a href="#DarkFream-125"><span class="linenos">125</span></a>                        <span class="n">content_type</span> <span class="o">=</span> <span class="s1">&#39;text/html&#39;</span>
</span><span id="DarkFream-126"><a href="#DarkFream-126"><span class="linenos">126</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DarkFream-127"><a href="#DarkFream-127"><span class="linenos">127</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid return value from route handler: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DarkFream-128"><a href="#DarkFream-128"><span class="linenos">128</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DarkFream-129"><a href="#DarkFream-129"><span class="linenos">129</span></a>                    <span class="n">status_code</span> <span class="o">=</span> <span class="mi">200</span>
</span><span id="DarkFream-130"><a href="#DarkFream-130"><span class="linenos">130</span></a>                    <span class="n">response_body</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="DarkFream-131"><a href="#DarkFream-131"><span class="linenos">131</span></a>                    <span class="n">content_type</span> <span class="o">=</span> <span class="s1">&#39;text/html&#39;</span>
</span><span id="DarkFream-132"><a href="#DarkFream-132"><span class="linenos">132</span></a>
</span><span id="DarkFream-133"><a href="#DarkFream-133"><span class="linenos">133</span></a>                <span class="k">if</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s1">&#39;application/json&#39;</span><span class="p">:</span>
</span><span id="DarkFream-134"><a href="#DarkFream-134"><span class="linenos">134</span></a>                    <span class="k">return</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span><span class="p">,</span> <span class="n">content_type</span>
</span><span id="DarkFream-135"><a href="#DarkFream-135"><span class="linenos">135</span></a>
</span><span id="DarkFream-136"><a href="#DarkFream-136"><span class="linenos">136</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response_body</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DarkFream-137"><a href="#DarkFream-137"><span class="linenos">137</span></a>                    <span class="k">return</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span><span class="p">,</span> <span class="n">content_type</span>
</span><span id="DarkFream-138"><a href="#DarkFream-138"><span class="linenos">138</span></a>
</span><span id="DarkFream-139"><a href="#DarkFream-139"><span class="linenos">139</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response_body</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DarkFream-140"><a href="#DarkFream-140"><span class="linenos">140</span></a>                    <span class="n">context</span> <span class="o">=</span> <span class="n">response_body</span>
</span><span id="DarkFream-141"><a href="#DarkFream-141"><span class="linenos">141</span></a>                    <span class="k">if</span> <span class="s1">&#39;session&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
</span><span id="DarkFream-142"><a href="#DarkFream-142"><span class="linenos">142</span></a>                        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;session&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="DarkFream-143"><a href="#DarkFream-143"><span class="linenos">143</span></a>                    <span class="k">return</span> <span class="n">status_code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_with_cache</span><span class="p">(</span><span class="n">response_body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;admin/base.html&#39;</span><span class="p">),</span> <span class="n">context</span><span class="p">),</span> <span class="n">content_type</span>
</span><span id="DarkFream-144"><a href="#DarkFream-144"><span class="linenos">144</span></a>
</span><span id="DarkFream-145"><a href="#DarkFream-145"><span class="linenos">145</span></a>        <span class="k">return</span> <span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;404 Not Found&quot;</span><span class="p">,</span> <span class="s1">&#39;text/html&#39;</span>
</span><span id="DarkFream-146"><a href="#DarkFream-146"><span class="linenos">146</span></a>
</span><span id="DarkFream-147"><a href="#DarkFream-147"><span class="linenos">147</span></a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{}):</span>
</span><span id="DarkFream-148"><a href="#DarkFream-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Рендерит шаблон с заданным контекстом.</span>
</span><span id="DarkFream-149"><a href="#DarkFream-149"><span class="linenos">149</span></a>
</span><span id="DarkFream-150"><a href="#DarkFream-150"><span class="linenos">150</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream-151"><a href="#DarkFream-151"><span class="linenos">151</span></a><span class="sd">            template_name (str): Имя шаблона для рендеринга.</span>
</span><span id="DarkFream-152"><a href="#DarkFream-152"><span class="linenos">152</span></a><span class="sd">            context (dict, optional): Контекст для шаблона. По умолчанию пустой словарь.</span>
</span><span id="DarkFream-153"><a href="#DarkFream-153"><span class="linenos">153</span></a>
</span><span id="DarkFream-154"><a href="#DarkFream-154"><span class="linenos">154</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream-155"><a href="#DarkFream-155"><span class="linenos">155</span></a><span class="sd">            str: Содержимое отрендеренного шаблона.</span>
</span><span id="DarkFream-156"><a href="#DarkFream-156"><span class="linenos">156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream-157"><a href="#DarkFream-157"><span class="linenos">157</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
</span><span id="DarkFream-158"><a href="#DarkFream-158"><span class="linenos">158</span></a>        <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span id="DarkFream-159"><a href="#DarkFream-159"><span class="linenos">159</span></a>
</span><span id="DarkFream-160"><a href="#DarkFream-160"><span class="linenos">160</span></a>    <span class="k">def</span> <span class="nf">render_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">template_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DarkFream-161"><a href="#DarkFream-161"><span class="linenos">161</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Рендерит ответ с заданным статусом и сообщением.</span>
</span><span id="DarkFream-162"><a href="#DarkFream-162"><span class="linenos">162</span></a>
</span><span id="DarkFream-163"><a href="#DarkFream-163"><span class="linenos">163</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream-164"><a href="#DarkFream-164"><span class="linenos">164</span></a><span class="sd">            status_code (int): Код статуса HTTP.</span>
</span><span id="DarkFream-165"><a href="#DarkFream-165"><span class="linenos">165</span></a><span class="sd">            message (str): Сообщение для отображения.</span>
</span><span id="DarkFream-166"><a href="#DarkFream-166"><span class="linenos">166</span></a><span class="sd">            template_name (str, optional): Имя шаблона для рендеринга. По умолчанию None.</span>
</span><span id="DarkFream-167"><a href="#DarkFream-167"><span class="linenos">167</span></a><span class="sd">            context (dict, optional): Контекст для шаблона. По умолчанию None.</span>
</span><span id="DarkFream-168"><a href="#DarkFream-168"><span class="linenos">168</span></a>
</span><span id="DarkFream-169"><a href="#DarkFream-169"><span class="linenos">169</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream-170"><a href="#DarkFream-170"><span class="linenos">170</span></a><span class="sd">            tuple: Кортеж, содержащий код статуса и сообщение, или отрендеренное содержимое.</span>
</span><span id="DarkFream-171"><a href="#DarkFream-171"><span class="linenos">171</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream-172"><a href="#DarkFream-172"><span class="linenos">172</span></a>        <span class="k">if</span> <span class="n">template_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DarkFream-173"><a href="#DarkFream-173"><span class="linenos">173</span></a>            <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">status_code</span><span class="p">,</span>
</span><span id="DarkFream-174"><a href="#DarkFream-174"><span class="linenos">174</span></a>                       <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">}</span>
</span><span id="DarkFream-175"><a href="#DarkFream-175"><span class="linenos">175</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_with_cache</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span><span id="DarkFream-176"><a href="#DarkFream-176"><span class="linenos">176</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">status_code</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span><span id="DarkFream-177"><a href="#DarkFream-177"><span class="linenos">177</span></a>
</span><span id="DarkFream-178"><a href="#DarkFream-178"><span class="linenos">178</span></a>    <span class="k">def</span> <span class="nf">cache_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">):</span>
</span><span id="DarkFream-179"><a href="#DarkFream-179"><span class="linenos">179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Кэширует шаблон для повторного использования.</span>
</span><span id="DarkFream-180"><a href="#DarkFream-180"><span class="linenos">180</span></a>
</span><span id="DarkFream-181"><a href="#DarkFream-181"><span class="linenos">181</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream-182"><a href="#DarkFream-182"><span class="linenos">182</span></a><span class="sd">            template_name (str): Имя шаблона для кэширования.</span>
</span><span id="DarkFream-183"><a href="#DarkFream-183"><span class="linenos">183</span></a>
</span><span id="DarkFream-184"><a href="#DarkFream-184"><span class="linenos">184</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream-185"><a href="#DarkFream-185"><span class="linenos">185</span></a><span class="sd">            Template: Отрендеренный шаблон.</span>
</span><span id="DarkFream-186"><a href="#DarkFream-186"><span class="linenos">186</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream-187"><a href="#DarkFream-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_template_cache&#39;</span><span class="p">):</span>
</span><span id="DarkFream-188"><a href="#DarkFream-188"><span class="linenos">188</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_template_cache</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DarkFream-189"><a href="#DarkFream-189"><span class="linenos">189</span></a>        <span class="k">if</span> <span class="n">template_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template_cache</span><span class="p">:</span>
</span><span id="DarkFream-190"><a href="#DarkFream-190"><span class="linenos">190</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_template_cache</span><span class="p">[</span><span class="n">template_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
</span><span id="DarkFream-191"><a href="#DarkFream-191"><span class="linenos">191</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template_cache</span><span class="p">[</span><span class="n">template_name</span><span class="p">]</span>
</span><span id="DarkFream-192"><a href="#DarkFream-192"><span class="linenos">192</span></a>
</span><span id="DarkFream-193"><a href="#DarkFream-193"><span class="linenos">193</span></a>    <span class="k">def</span> <span class="nf">render_with_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{}):</span>
</span><span id="DarkFream-194"><a href="#DarkFream-194"><span class="linenos">194</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Рендерит шаблон с кэшированием.</span>
</span><span id="DarkFream-195"><a href="#DarkFream-195"><span class="linenos">195</span></a>
</span><span id="DarkFream-196"><a href="#DarkFream-196"><span class="linenos">196</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream-197"><a href="#DarkFream-197"><span class="linenos">197</span></a><span class="sd">            template_name (str): Имя шаблона для рендеринга.</span>
</span><span id="DarkFream-198"><a href="#DarkFream-198"><span class="linenos">198</span></a><span class="sd">            context (dict, optional): Контекст для шаблона. По умолчанию пустой словарь.</span>
</span><span id="DarkFream-199"><a href="#DarkFream-199"><span class="linenos">199</span></a>
</span><span id="DarkFream-200"><a href="#DarkFream-200"><span class="linenos">200</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream-201"><a href="#DarkFream-201"><span class="linenos">201</span></a><span class="sd">            str: Содержимое отрендеренного шаблона.</span>
</span><span id="DarkFream-202"><a href="#DarkFream-202"><span class="linenos">202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream-203"><a href="#DarkFream-203"><span class="linenos">203</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
</span><span id="DarkFream-204"><a href="#DarkFream-204"><span class="linenos">204</span></a>        <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span id="DarkFream-205"><a href="#DarkFream-205"><span class="linenos">205</span></a>
</span><span id="DarkFream-206"><a href="#DarkFream-206"><span class="linenos">206</span></a>    <span class="k">def</span> <span class="nf">redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">):</span>
</span><span id="DarkFream-207"><a href="#DarkFream-207"><span class="linenos">207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Перенаправляет на указанный путь.</span>
</span><span id="DarkFream-208"><a href="#DarkFream-208"><span class="linenos">208</span></a>
</span><span id="DarkFream-209"><a href="#DarkFream-209"><span class="linenos">209</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream-210"><a href="#DarkFream-210"><span class="linenos">210</span></a><span class="sd">            path (str): Путь для перенаправления.</span>
</span><span id="DarkFream-211"><a href="#DarkFream-211"><span class="linenos">211</span></a><span class="sd">            method (str, optional): HTTP-метод для перенаправления. По умолчанию &#39;GET&#39;.</span>
</span><span id="DarkFream-212"><a href="#DarkFream-212"><span class="linenos">212</span></a>
</span><span id="DarkFream-213"><a href="#DarkFream-213"><span class="linenos">213</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream-214"><a href="#DarkFream-214"><span class="linenos">214</span></a><span class="sd">            tuple: Кортеж, содержащий код статуса, пустое тело и заголовки для перенаправления.</span>
</span><span id="DarkFream-215"><a href="#DarkFream-215"><span class="linenos">215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream-216"><a href="#DarkFream-216"><span class="linenos">216</span></a>        <span class="k">return</span> <span class="p">(</span><span class="mi">302</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span id="DarkFream-217"><a href="#DarkFream-217"><span class="linenos">217</span></a>            <span class="s1">&#39;Location&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
</span><span id="DarkFream-218"><a href="#DarkFream-218"><span class="linenos">218</span></a>            <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html&#39;</span>
</span><span id="DarkFream-219"><a href="#DarkFream-219"><span class="linenos">219</span></a>        <span class="p">})</span>
</span><span id="DarkFream-220"><a href="#DarkFream-220"><span class="linenos">220</span></a>
</span><span id="DarkFream-221"><a href="#DarkFream-221"><span class="linenos">221</span></a>    <span class="k">def</span> <span class="nf">api_route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]):</span>
</span><span id="DarkFream-222"><a href="#DarkFream-222"><span class="linenos">222</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Декоратор для регистрации API маршрута.</span>
</span><span id="DarkFream-223"><a href="#DarkFream-223"><span class="linenos">223</span></a>
</span><span id="DarkFream-224"><a href="#DarkFream-224"><span class="linenos">224</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream-225"><a href="#DarkFream-225"><span class="linenos">225</span></a><span class="sd">            path (str): Путь для API маршрута.</span>
</span><span id="DarkFream-226"><a href="#DarkFream-226"><span class="linenos">226</span></a><span class="sd">            methods (list, optional): Список HTTP-методов, поддерживаемых маршрутом. По умолчанию [&#39;GET&#39;].</span>
</span><span id="DarkFream-227"><a href="#DarkFream-227"><span class="linenos">227</span></a>
</span><span id="DarkFream-228"><a href="#DarkFream-228"><span class="linenos">228</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream-229"><a href="#DarkFream-229"><span class="linenos">229</span></a><span class="sd">            callable: Обернутый обработчик API маршрута.</span>
</span><span id="DarkFream-230"><a href="#DarkFream-230"><span class="linenos">230</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream-231"><a href="#DarkFream-231"><span class="linenos">231</span></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="DarkFream-232"><a href="#DarkFream-232"><span class="linenos">232</span></a>            <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">:</span>
</span><span id="DarkFream-233"><a href="#DarkFream-233"><span class="linenos">233</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DarkFream-234"><a href="#DarkFream-234"><span class="linenos">234</span></a>            <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
</span><span id="DarkFream-235"><a href="#DarkFream-235"><span class="linenos">235</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_handler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="DarkFream-236"><a href="#DarkFream-236"><span class="linenos">236</span></a>            <span class="k">return</span> <span class="n">func</span>
</span><span id="DarkFream-237"><a href="#DarkFream-237"><span class="linenos">237</span></a>        <span class="k">return</span> <span class="n">wrapper</span>
</span><span id="DarkFream-238"><a href="#DarkFream-238"><span class="linenos">238</span></a>
</span><span id="DarkFream-239"><a href="#DarkFream-239"><span class="linenos">239</span></a>    <span class="k">def</span> <span class="nf">api_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
</span><span id="DarkFream-240"><a href="#DarkFream-240"><span class="linenos">240</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Обработчик для API маршрута, обрабатывающий ошибки.</span>
</span><span id="DarkFream-241"><a href="#DarkFream-241"><span class="linenos">241</span></a>
</span><span id="DarkFream-242"><a href="#DarkFream-242"><span class="linenos">242</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream-243"><a href="#DarkFream-243"><span class="linenos">243</span></a><span class="sd">            func (callable): Обработчик API.</span>
</span><span id="DarkFream-244"><a href="#DarkFream-244"><span class="linenos">244</span></a>
</span><span id="DarkFream-245"><a href="#DarkFream-245"><span class="linenos">245</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream-246"><a href="#DarkFream-246"><span class="linenos">246</span></a><span class="sd">            callable: Обернутый обработчик с обработкой ошибок.</span>
</span><span id="DarkFream-247"><a href="#DarkFream-247"><span class="linenos">247</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream-248"><a href="#DarkFream-248"><span class="linenos">248</span></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="DarkFream-249"><a href="#DarkFream-249"><span class="linenos">249</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DarkFream-250"><a href="#DarkFream-250"><span class="linenos">250</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="DarkFream-251"><a href="#DarkFream-251"><span class="linenos">251</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span><span id="DarkFream-252"><a href="#DarkFream-252"><span class="linenos">252</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DarkFream-253"><a href="#DarkFream-253"><span class="linenos">253</span></a>                <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="DarkFream-254"><a href="#DarkFream-254"><span class="linenos">254</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>
</span><span id="DarkFream-255"><a href="#DarkFream-255"><span class="linenos">255</span></a>        <span class="k">return</span> <span class="n">wrapper</span>
</span><span id="DarkFream-256"><a href="#DarkFream-256"><span class="linenos">256</span></a>    <span class="k">def</span> <span class="nf">json_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="DarkFream-257"><a href="#DarkFream-257"><span class="linenos">257</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Создает JSON-ответ с заданным статусом и данными.</span>
</span><span id="DarkFream-258"><a href="#DarkFream-258"><span class="linenos">258</span></a>
</span><span id="DarkFream-259"><a href="#DarkFream-259"><span class="linenos">259</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream-260"><a href="#DarkFream-260"><span class="linenos">260</span></a><span class="sd">            status_code (int): Код статуса HTTP.</span>
</span><span id="DarkFream-261"><a href="#DarkFream-261"><span class="linenos">261</span></a><span class="sd">            data (dict): Данные, которые будут включены в JSON-ответ.</span>
</span><span id="DarkFream-262"><a href="#DarkFream-262"><span class="linenos">262</span></a>
</span><span id="DarkFream-263"><a href="#DarkFream-263"><span class="linenos">263</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream-264"><a href="#DarkFream-264"><span class="linenos">264</span></a><span class="sd">            tuple: Кортеж, содержащий код статуса, JSON-строку и заголовки для ответа.</span>
</span><span id="DarkFream-265"><a href="#DarkFream-265"><span class="linenos">265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream-266"><a href="#DarkFream-266"><span class="linenos">266</span></a>        <span class="kn">import</span> <span class="nn">json</span>
</span><span id="DarkFream-267"><a href="#DarkFream-267"><span class="linenos">267</span></a>        <span class="n">response_body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="DarkFream-268"><a href="#DarkFream-268"><span class="linenos">268</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DarkFream-269"><a href="#DarkFream-269"><span class="linenos">269</span></a>            <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span id="DarkFream-270"><a href="#DarkFream-270"><span class="linenos">270</span></a>            <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span><span id="DarkFream-271"><a href="#DarkFream-271"><span class="linenos">271</span></a>            <span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">:</span> <span class="s1">&#39;GET, POST, OPTIONS&#39;</span><span class="p">,</span>
</span><span id="DarkFream-272"><a href="#DarkFream-272"><span class="linenos">272</span></a>            <span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">:</span> <span class="s1">&#39;Content-Type&#39;</span>
</span><span id="DarkFream-273"><a href="#DarkFream-273"><span class="linenos">273</span></a>        <span class="p">}</span>
</span><span id="DarkFream-274"><a href="#DarkFream-274"><span class="linenos">274</span></a>        <span class="k">return</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span><span class="p">,</span> <span class="n">headers</span>
</span><span id="DarkFream-275"><a href="#DarkFream-275"><span class="linenos">275</span></a>
</span><span id="DarkFream-276"><a href="#DarkFream-276"><span class="linenos">276</span></a>
</span><span id="DarkFream-277"><a href="#DarkFream-277"><span class="linenos">277</span></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_address</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">):</span>
</span><span id="DarkFream-278"><a href="#DarkFream-278"><span class="linenos">278</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Запускает HTTP сервер.</span>
</span><span id="DarkFream-279"><a href="#DarkFream-279"><span class="linenos">279</span></a>
</span><span id="DarkFream-280"><a href="#DarkFream-280"><span class="linenos">280</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream-281"><a href="#DarkFream-281"><span class="linenos">281</span></a><span class="sd">            server_address (str): Адрес сервера. По умолчанию пустая строка.</span>
</span><span id="DarkFream-282"><a href="#DarkFream-282"><span class="linenos">282</span></a><span class="sd">            port (int): Порт, на котором будет запущен сервер. По умолчанию 8000.</span>
</span><span id="DarkFream-283"><a href="#DarkFream-283"><span class="linenos">283</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream-284"><a href="#DarkFream-284"><span class="linenos">284</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_plugins</span><span class="p">()</span>
</span><span id="DarkFream-285"><a href="#DarkFream-285"><span class="linenos">285</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DarkFream-286"><a href="#DarkFream-286"><span class="linenos">286</span></a>            <span class="n">handler</span> <span class="o">=</span> <span class="n">get_handler</span><span class="p">()</span> <span class="ow">or</span> <span class="n">DarkHandler</span>
</span><span id="DarkFream-287"><a href="#DarkFream-287"><span class="linenos">287</span></a>            <span class="n">httpd</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">((</span><span class="n">server_address</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">handler</span><span class="p">)</span>
</span><span id="DarkFream-288"><a href="#DarkFream-288"><span class="linenos">288</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Serving on port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
</span><span id="DarkFream-289"><a href="#DarkFream-289"><span class="linenos">289</span></a>            <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</span><span id="DarkFream-290"><a href="#DarkFream-290"><span class="linenos">290</span></a>        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="DarkFream-291"><a href="#DarkFream-291"><span class="linenos">291</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Server stopped&#39;</span><span class="p">)</span>
</span><span id="DarkFream-292"><a href="#DarkFream-292"><span class="linenos">292</span></a>
</span><span id="DarkFream-293"><a href="#DarkFream-293"><span class="linenos">293</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">receive</span><span class="p">,</span> <span class="n">send</span><span class="p">):</span>
</span><span id="DarkFream-294"><a href="#DarkFream-294"><span class="linenos">294</span></a>        <span class="n">request</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">receive</span><span class="p">)</span>
</span><span id="DarkFream-295"><a href="#DarkFream-295"><span class="linenos">295</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span>
</span><span id="DarkFream-296"><a href="#DarkFream-296"><span class="linenos">296</span></a>
</span><span id="DarkFream-297"><a href="#DarkFream-297"><span class="linenos">297</span></a>        <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DarkFream-298"><a href="#DarkFream-298"><span class="linenos">298</span></a>            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
</span><span id="DarkFream-299"><a href="#DarkFream-299"><span class="linenos">299</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span id="DarkFream-300"><a href="#DarkFream-300"><span class="linenos">300</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">send</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
</span><span id="DarkFream-301"><a href="#DarkFream-301"><span class="linenos">301</span></a>                <span class="k">return</span>
</span><span id="DarkFream-302"><a href="#DarkFream-302"><span class="linenos">302</span></a>
</span><span id="DarkFream-303"><a href="#DarkFream-303"><span class="linenos">303</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">send_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">send</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
</span><span id="DarkFream-304"><a href="#DarkFream-304"><span class="linenos">304</span></a>        <span class="k">await</span> <span class="n">send</span><span class="p">({</span>
</span><span id="DarkFream-305"><a href="#DarkFream-305"><span class="linenos">305</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;http.response.start&quot;</span><span class="p">,</span>
</span><span id="DarkFream-306"><a href="#DarkFream-306"><span class="linenos">306</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="DarkFream-307"><a href="#DarkFream-307"><span class="linenos">307</span></a>            <span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="n">k</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">v</span><span class="o">.</span><span class="n">encode</span><span class="p">()]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;headers&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span>
</span><span id="DarkFream-308"><a href="#DarkFream-308"><span class="linenos">308</span></a>        <span class="p">})</span>
</span><span id="DarkFream-309"><a href="#DarkFream-309"><span class="linenos">309</span></a>        <span class="k">await</span> <span class="n">send</span><span class="p">({</span>
</span><span id="DarkFream-310"><a href="#DarkFream-310"><span class="linenos">310</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;http.response.body&quot;</span><span class="p">,</span>
</span><span id="DarkFream-311"><a href="#DarkFream-311"><span class="linenos">311</span></a>            <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">)</span> <span class="k">else</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
</span><span id="DarkFream-312"><a href="#DarkFream-312"><span class="linenos">312</span></a>        <span class="p">})</span>
</span></pre></div>


            <div class="docstring"><p>Основной класс приложения DarkFream, который обрабатывает маршрутизацию и запросы.</p>
</div>


                            <div id="DarkFream.__init__" class="classattr">
                                        <input id="DarkFream.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="name">DarkFream</span><span class="signature pdoc-code condensed">()</span>

                <label class="view-source-button" for="DarkFream.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream.__init__-20"><a href="#DarkFream.__init__-20"><span class="linenos">20</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DarkFream.__init__-21"><a href="#DarkFream.__init__-21"><span class="linenos">21</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Инициализирует DarkFream с необходимыми компонентами, такими как маршруты и шаблоны.&quot;&quot;&quot;</span>
</span><span id="DarkFream.__init__-22"><a href="#DarkFream.__init__-22"><span class="linenos">22</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">routes</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DarkFream.__init__-23"><a href="#DarkFream.__init__-23"><span class="linenos">23</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">static_handlers</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DarkFream.__init__-24"><a href="#DarkFream.__init__-24"><span class="linenos">24</span></a>        <span class="n">framework_templates_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">&#39;templates&#39;</span><span class="p">)</span>
</span><span id="DarkFream.__init__-25"><a href="#DarkFream.__init__-25"><span class="linenos">25</span></a>        <span class="n">user_templates_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;templates&#39;</span><span class="p">)</span>
</span><span id="DarkFream.__init__-26"><a href="#DarkFream.__init__-26"><span class="linenos">26</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">ChoiceLoader</span><span class="p">([</span>
</span><span id="DarkFream.__init__-27"><a href="#DarkFream.__init__-27"><span class="linenos">27</span></a>            <span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">user_templates_dir</span><span class="p">),</span>
</span><span id="DarkFream.__init__-28"><a href="#DarkFream.__init__-28"><span class="linenos">28</span></a>            <span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">framework_templates_dir</span><span class="p">)</span>
</span><span id="DarkFream.__init__-29"><a href="#DarkFream.__init__-29"><span class="linenos">29</span></a>        <span class="p">]))</span>
</span><span id="DarkFream.__init__-30"><a href="#DarkFream.__init__-30"><span class="linenos">30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s1">&#39;getattr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span>
</span><span id="DarkFream.__init__-31"><a href="#DarkFream.__init__-31"><span class="linenos">31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">admin</span> <span class="o">=</span> <span class="n">DarkAdmin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="DarkFream.__init__-32"><a href="#DarkFream.__init__-32"><span class="linenos">32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span> <span class="o">=</span> <span class="n">PluginManager</span><span class="p">()</span>
</span><span id="DarkFream.__init__-33"><a href="#DarkFream.__init__-33"><span class="linenos">33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_config</span> <span class="o">=</span> <span class="n">PluginConfig</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Инициализирует DarkFream с необходимыми компонентами, такими как маршруты и шаблоны.</p>
</div>


                            </div>
                            <div id="DarkFream.routes" class="classattr">
                                <div class="attr variable">
            <span class="name">routes</span>


    </div>
    <a class="headerlink" href="#DarkFream.routes"></a>



                            </div>
                            <div id="DarkFream.static_handlers" class="classattr">
                                <div class="attr variable">
            <span class="name">static_handlers</span>


    </div>
    <a class="headerlink" href="#DarkFream.static_handlers"></a>



                            </div>
                            <div id="DarkFream.env" class="classattr">
                                <div class="attr variable">
            <span class="name">env</span>


    </div>
    <a class="headerlink" href="#DarkFream.env"></a>



                            </div>
                            <div id="DarkFream.admin" class="classattr">
                                <div class="attr variable">
            <span class="name">admin</span>


    </div>
    <a class="headerlink" href="#DarkFream.admin"></a>



                            </div>
                            <div id="DarkFream.plugin_manager" class="classattr">
                                <div class="attr variable">
            <span class="name">plugin_manager</span>


    </div>
    <a class="headerlink" href="#DarkFream.plugin_manager"></a>



                            </div>
                            <div id="DarkFream.plugin_config" class="classattr">
                                <div class="attr variable">
            <span class="name">plugin_config</span>


    </div>
    <a class="headerlink" href="#DarkFream.plugin_config"></a>



                            </div>
                            <div id="DarkFream.mount" class="classattr">
                                        <input id="DarkFream.mount-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">mount</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">prefix</span>, </span><span class="param"><span class="n">handler</span>, </span><span class="param"><span class="n">name</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkFream.mount-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream.mount"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream.mount-35"><a href="#DarkFream.mount-35"><span class="linenos">35</span></a>    <span class="k">def</span> <span class="nf">mount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DarkFream.mount-36"><a href="#DarkFream.mount-36"><span class="linenos">36</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Подключает статический обработчик к указанному префиксу.</span>
</span><span id="DarkFream.mount-37"><a href="#DarkFream.mount-37"><span class="linenos">37</span></a>
</span><span id="DarkFream.mount-38"><a href="#DarkFream.mount-38"><span class="linenos">38</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream.mount-39"><a href="#DarkFream.mount-39"><span class="linenos">39</span></a><span class="sd">            prefix (str): Префикс URL, к которому будет подключен обработчик.</span>
</span><span id="DarkFream.mount-40"><a href="#DarkFream.mount-40"><span class="linenos">40</span></a><span class="sd">            handler (callable): Обработчик, который будет вызываться для данного префикса.</span>
</span><span id="DarkFream.mount-41"><a href="#DarkFream.mount-41"><span class="linenos">41</span></a><span class="sd">            name (str, optional): Имя обработчика. По умолчанию None.</span>
</span><span id="DarkFream.mount-42"><a href="#DarkFream.mount-42"><span class="linenos">42</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream.mount-43"><a href="#DarkFream.mount-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">static_handlers</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="n">handler</span>
</span></pre></div>


            <div class="docstring"><p>Подключает статический обработчик к указанному префиксу.</p>

<p>Args:
    prefix (str): Префикс URL, к которому будет подключен обработчик.
    handler (callable): Обработчик, который будет вызываться для данного префикса.
    name (str, optional): Имя обработчика. По умолчанию None.</p>
</div>


                            </div>
                            <div id="DarkFream.load_plugins" class="classattr">
                                        <input id="DarkFream.load_plugins-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">load_plugins</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkFream.load_plugins-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream.load_plugins"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream.load_plugins-45"><a href="#DarkFream.load_plugins-45"><span class="linenos">45</span></a>    <span class="k">def</span> <span class="nf">load_plugins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DarkFream.load_plugins-46"><a href="#DarkFream.load_plugins-46"><span class="linenos">46</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Загружает все включенные плагины и инициализирует их.&quot;&quot;&quot;</span>
</span><span id="DarkFream.load_plugins-47"><a href="#DarkFream.load_plugins-47"><span class="linenos">47</span></a>        <span class="k">for</span> <span class="n">plugin_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugin_config</span><span class="o">.</span><span class="n">enabled_plugins</span><span class="p">:</span>
</span><span id="DarkFream.load_plugins-48"><a href="#DarkFream.load_plugins-48"><span class="linenos">48</span></a>            <span class="n">plugin_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span><span class="o">.</span><span class="n">get_plugin</span><span class="p">(</span><span class="n">plugin_name</span><span class="p">)</span>
</span><span id="DarkFream.load_plugins-49"><a href="#DarkFream.load_plugins-49"><span class="linenos">49</span></a>            <span class="k">if</span> <span class="n">plugin_class</span><span class="p">:</span>
</span><span id="DarkFream.load_plugins-50"><a href="#DarkFream.load_plugins-50"><span class="linenos">50</span></a>                <span class="n">plugin</span> <span class="o">=</span> <span class="n">plugin_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="DarkFream.load_plugins-51"><a href="#DarkFream.load_plugins-51"><span class="linenos">51</span></a>                <span class="n">plugin</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Загружает все включенные плагины и инициализирует их.</p>
</div>


                            </div>
                            <div id="DarkFream.route" class="classattr">
                                        <input id="DarkFream.route-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">route</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span>, </span><span class="param"><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkFream.route-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream.route"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream.route-53"><a href="#DarkFream.route-53"><span class="linenos">53</span></a>    <span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]):</span>
</span><span id="DarkFream.route-54"><a href="#DarkFream.route-54"><span class="linenos">54</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Декоратор для регистрации маршрута.</span>
</span><span id="DarkFream.route-55"><a href="#DarkFream.route-55"><span class="linenos">55</span></a>
</span><span id="DarkFream.route-56"><a href="#DarkFream.route-56"><span class="linenos">56</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream.route-57"><a href="#DarkFream.route-57"><span class="linenos">57</span></a><span class="sd">            path (str): Путь для маршрута.</span>
</span><span id="DarkFream.route-58"><a href="#DarkFream.route-58"><span class="linenos">58</span></a><span class="sd">            methods (list, optional): Список HTTP-методов, поддерживаемых маршрутом. По умолчанию [&#39;GET&#39;].</span>
</span><span id="DarkFream.route-59"><a href="#DarkFream.route-59"><span class="linenos">59</span></a>
</span><span id="DarkFream.route-60"><a href="#DarkFream.route-60"><span class="linenos">60</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream.route-61"><a href="#DarkFream.route-61"><span class="linenos">61</span></a><span class="sd">            callable: Обернутый обработчик маршрута.</span>
</span><span id="DarkFream.route-62"><a href="#DarkFream.route-62"><span class="linenos">62</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream.route-63"><a href="#DarkFream.route-63"><span class="linenos">63</span></a>        <span class="n">path_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;([^&gt;]+)&gt;&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(?P&lt;\1&gt;[^/]+)&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="DarkFream.route-64"><a href="#DarkFream.route-64"><span class="linenos">64</span></a>        <span class="n">path_regex</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;^</span><span class="si">{</span><span class="n">path_regex</span><span class="si">}</span><span class="s1">$&#39;</span>
</span><span id="DarkFream.route-65"><a href="#DarkFream.route-65"><span class="linenos">65</span></a>
</span><span id="DarkFream.route-66"><a href="#DarkFream.route-66"><span class="linenos">66</span></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="DarkFream.route-67"><a href="#DarkFream.route-67"><span class="linenos">67</span></a>            <span class="k">if</span> <span class="n">path_regex</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">:</span>
</span><span id="DarkFream.route-68"><a href="#DarkFream.route-68"><span class="linenos">68</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">path_regex</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DarkFream.route-69"><a href="#DarkFream.route-69"><span class="linenos">69</span></a>
</span><span id="DarkFream.route-70"><a href="#DarkFream.route-70"><span class="linenos">70</span></a>            <span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
</span><span id="DarkFream.route-71"><a href="#DarkFream.route-71"><span class="linenos">71</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">path_regex</span><span class="p">][</span><span class="s1">&#39;*&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="DarkFream.route-72"><a href="#DarkFream.route-72"><span class="linenos">72</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DarkFream.route-73"><a href="#DarkFream.route-73"><span class="linenos">73</span></a>                <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
</span><span id="DarkFream.route-74"><a href="#DarkFream.route-74"><span class="linenos">74</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">path_regex</span><span class="p">][</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="DarkFream.route-75"><a href="#DarkFream.route-75"><span class="linenos">75</span></a>
</span><span id="DarkFream.route-76"><a href="#DarkFream.route-76"><span class="linenos">76</span></a>            <span class="k">return</span> <span class="n">func</span>
</span><span id="DarkFream.route-77"><a href="#DarkFream.route-77"><span class="linenos">77</span></a>        <span class="k">return</span> <span class="n">wrapper</span>
</span></pre></div>


            <div class="docstring"><p>Декоратор для регистрации маршрута.</p>

<p>Args:
    path (str): Путь для маршрута.
    methods (list, optional): Список HTTP-методов, поддерживаемых маршрутом. По умолчанию ['GET'].</p>

<p>Returns:
    callable: Обернутый обработчик маршрута.</p>
</div>


                            </div>
                            <div id="DarkFream.route_404" class="classattr">
                                        <input id="DarkFream.route_404-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">route_404</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">func</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkFream.route_404-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream.route_404"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream.route_404-79"><a href="#DarkFream.route_404-79"><span class="linenos">79</span></a>    <span class="k">def</span> <span class="nf">route_404</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
</span><span id="DarkFream.route_404-80"><a href="#DarkFream.route_404-80"><span class="linenos">80</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Регистрирует обработчик для маршрута 404.</span>
</span><span id="DarkFream.route_404-81"><a href="#DarkFream.route_404-81"><span class="linenos">81</span></a>
</span><span id="DarkFream.route_404-82"><a href="#DarkFream.route_404-82"><span class="linenos">82</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream.route_404-83"><a href="#DarkFream.route_404-83"><span class="linenos">83</span></a><span class="sd">            func (callable): Обработчик, который будет вызван при отсутствии маршрута.</span>
</span><span id="DarkFream.route_404-84"><a href="#DarkFream.route_404-84"><span class="linenos">84</span></a>
</span><span id="DarkFream.route_404-85"><a href="#DarkFream.route_404-85"><span class="linenos">85</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream.route_404-86"><a href="#DarkFream.route_404-86"><span class="linenos">86</span></a><span class="sd">            callable: Обернутый обработчик маршрута 404.</span>
</span><span id="DarkFream.route_404-87"><a href="#DarkFream.route_404-87"><span class="linenos">87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream.route_404-88"><a href="#DarkFream.route_404-88"><span class="linenos">88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="s1">&#39;404&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="DarkFream.route_404-89"><a href="#DarkFream.route_404-89"><span class="linenos">89</span></a>        <span class="k">return</span> <span class="n">func</span>
</span></pre></div>


            <div class="docstring"><p>Регистрирует обработчик для маршрута 404.</p>

<p>Args:
    func (callable): Обработчик, который будет вызван при отсутствии маршрута.</p>

<p>Returns:
    callable: Обернутый обработчик маршрута 404.</p>
</div>


                            </div>
                            <div id="DarkFream.handle_request" class="classattr">
                                        <input id="DarkFream.handle_request-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">handle_request</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span>, </span><span class="param"><span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span>, </span><span class="param"><span class="n">data</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkFream.handle_request-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream.handle_request"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream.handle_request-91"><a href="#DarkFream.handle_request-91"><span class="linenos"> 91</span></a>    <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DarkFream.handle_request-92"><a href="#DarkFream.handle_request-92"><span class="linenos"> 92</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Обрабатывает входящий HTTP-запрос.</span>
</span><span id="DarkFream.handle_request-93"><a href="#DarkFream.handle_request-93"><span class="linenos"> 93</span></a>
</span><span id="DarkFream.handle_request-94"><a href="#DarkFream.handle_request-94"><span class="linenos"> 94</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream.handle_request-95"><a href="#DarkFream.handle_request-95"><span class="linenos"> 95</span></a><span class="sd">            path (str): Путь запроса.</span>
</span><span id="DarkFream.handle_request-96"><a href="#DarkFream.handle_request-96"><span class="linenos"> 96</span></a><span class="sd">            method (str, optional): HTTP-метод запроса. По умолчанию &#39;GET&#39;.</span>
</span><span id="DarkFream.handle_request-97"><a href="#DarkFream.handle_request-97"><span class="linenos"> 97</span></a><span class="sd">            data (dict, optional): Данные запроса. По умолчанию None.</span>
</span><span id="DarkFream.handle_request-98"><a href="#DarkFream.handle_request-98"><span class="linenos"> 98</span></a>
</span><span id="DarkFream.handle_request-99"><a href="#DarkFream.handle_request-99"><span class="linenos"> 99</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream.handle_request-100"><a href="#DarkFream.handle_request-100"><span class="linenos">100</span></a><span class="sd">            tuple: Кортеж, содержащий статус-код, тело ответа и тип контента.</span>
</span><span id="DarkFream.handle_request-101"><a href="#DarkFream.handle_request-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream.handle_request-102"><a href="#DarkFream.handle_request-102"><span class="linenos">102</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DarkFream.handle_request-103"><a href="#DarkFream.handle_request-103"><span class="linenos">103</span></a>            <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span><span id="DarkFream.handle_request-104"><a href="#DarkFream.handle_request-104"><span class="linenos">104</span></a>            <span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">:</span> <span class="s1">&#39;GET, POST, OPTIONS&#39;</span><span class="p">,</span>
</span><span id="DarkFream.handle_request-105"><a href="#DarkFream.handle_request-105"><span class="linenos">105</span></a>            <span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">:</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span>
</span><span id="DarkFream.handle_request-106"><a href="#DarkFream.handle_request-106"><span class="linenos">106</span></a>            <span class="s1">&#39;Access-Control-Allow-Credentials&#39;</span><span class="p">:</span> <span class="s1">&#39;true&#39;</span>
</span><span id="DarkFream.handle_request-107"><a href="#DarkFream.handle_request-107"><span class="linenos">107</span></a>        <span class="p">}</span>
</span><span id="DarkFream.handle_request-108"><a href="#DarkFream.handle_request-108"><span class="linenos">108</span></a>
</span><span id="DarkFream.handle_request-109"><a href="#DarkFream.handle_request-109"><span class="linenos">109</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span>
</span><span id="DarkFream.handle_request-110"><a href="#DarkFream.handle_request-110"><span class="linenos">110</span></a>            <span class="k">return</span> <span class="mi">204</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">headers</span>
</span><span id="DarkFream.handle_request-111"><a href="#DarkFream.handle_request-111"><span class="linenos">111</span></a>
</span><span id="DarkFream.handle_request-112"><a href="#DarkFream.handle_request-112"><span class="linenos">112</span></a>        <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">methods</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DarkFream.handle_request-113"><a href="#DarkFream.handle_request-113"><span class="linenos">113</span></a>            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="DarkFream.handle_request-114"><a href="#DarkFream.handle_request-114"><span class="linenos">114</span></a>            <span class="k">if</span> <span class="n">match</span> <span class="ow">and</span> <span class="p">(</span><span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span> <span class="ow">or</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">):</span>
</span><span id="DarkFream.handle_request-115"><a href="#DarkFream.handle_request-115"><span class="linenos">115</span></a>                <span class="n">kwargs</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
</span><span id="DarkFream.handle_request-116"><a href="#DarkFream.handle_request-116"><span class="linenos">116</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">methods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">methods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">))(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="DarkFream.handle_request-117"><a href="#DarkFream.handle_request-117"><span class="linenos">117</span></a>
</span><span id="DarkFream.handle_request-118"><a href="#DarkFream.handle_request-118"><span class="linenos">118</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="DarkFream.handle_request-119"><a href="#DarkFream.handle_request-119"><span class="linenos">119</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="DarkFream.handle_request-120"><a href="#DarkFream.handle_request-120"><span class="linenos">120</span></a>                        <span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span><span class="p">,</span> <span class="n">content_type</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="DarkFream.handle_request-121"><a href="#DarkFream.handle_request-121"><span class="linenos">121</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DarkFream.handle_request-122"><a href="#DarkFream.handle_request-122"><span class="linenos">122</span></a>                            <span class="n">content_type</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
</span><span id="DarkFream.handle_request-123"><a href="#DarkFream.handle_request-123"><span class="linenos">123</span></a>                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="DarkFream.handle_request-124"><a href="#DarkFream.handle_request-124"><span class="linenos">124</span></a>                        <span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="DarkFream.handle_request-125"><a href="#DarkFream.handle_request-125"><span class="linenos">125</span></a>                        <span class="n">content_type</span> <span class="o">=</span> <span class="s1">&#39;text/html&#39;</span>
</span><span id="DarkFream.handle_request-126"><a href="#DarkFream.handle_request-126"><span class="linenos">126</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DarkFream.handle_request-127"><a href="#DarkFream.handle_request-127"><span class="linenos">127</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid return value from route handler: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DarkFream.handle_request-128"><a href="#DarkFream.handle_request-128"><span class="linenos">128</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DarkFream.handle_request-129"><a href="#DarkFream.handle_request-129"><span class="linenos">129</span></a>                    <span class="n">status_code</span> <span class="o">=</span> <span class="mi">200</span>
</span><span id="DarkFream.handle_request-130"><a href="#DarkFream.handle_request-130"><span class="linenos">130</span></a>                    <span class="n">response_body</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="DarkFream.handle_request-131"><a href="#DarkFream.handle_request-131"><span class="linenos">131</span></a>                    <span class="n">content_type</span> <span class="o">=</span> <span class="s1">&#39;text/html&#39;</span>
</span><span id="DarkFream.handle_request-132"><a href="#DarkFream.handle_request-132"><span class="linenos">132</span></a>
</span><span id="DarkFream.handle_request-133"><a href="#DarkFream.handle_request-133"><span class="linenos">133</span></a>                <span class="k">if</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s1">&#39;application/json&#39;</span><span class="p">:</span>
</span><span id="DarkFream.handle_request-134"><a href="#DarkFream.handle_request-134"><span class="linenos">134</span></a>                    <span class="k">return</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span><span class="p">,</span> <span class="n">content_type</span>
</span><span id="DarkFream.handle_request-135"><a href="#DarkFream.handle_request-135"><span class="linenos">135</span></a>
</span><span id="DarkFream.handle_request-136"><a href="#DarkFream.handle_request-136"><span class="linenos">136</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response_body</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DarkFream.handle_request-137"><a href="#DarkFream.handle_request-137"><span class="linenos">137</span></a>                    <span class="k">return</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span><span class="p">,</span> <span class="n">content_type</span>
</span><span id="DarkFream.handle_request-138"><a href="#DarkFream.handle_request-138"><span class="linenos">138</span></a>
</span><span id="DarkFream.handle_request-139"><a href="#DarkFream.handle_request-139"><span class="linenos">139</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response_body</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DarkFream.handle_request-140"><a href="#DarkFream.handle_request-140"><span class="linenos">140</span></a>                    <span class="n">context</span> <span class="o">=</span> <span class="n">response_body</span>
</span><span id="DarkFream.handle_request-141"><a href="#DarkFream.handle_request-141"><span class="linenos">141</span></a>                    <span class="k">if</span> <span class="s1">&#39;session&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
</span><span id="DarkFream.handle_request-142"><a href="#DarkFream.handle_request-142"><span class="linenos">142</span></a>                        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;session&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="DarkFream.handle_request-143"><a href="#DarkFream.handle_request-143"><span class="linenos">143</span></a>                    <span class="k">return</span> <span class="n">status_code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_with_cache</span><span class="p">(</span><span class="n">response_body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;admin/base.html&#39;</span><span class="p">),</span> <span class="n">context</span><span class="p">),</span> <span class="n">content_type</span>
</span><span id="DarkFream.handle_request-144"><a href="#DarkFream.handle_request-144"><span class="linenos">144</span></a>
</span><span id="DarkFream.handle_request-145"><a href="#DarkFream.handle_request-145"><span class="linenos">145</span></a>        <span class="k">return</span> <span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;404 Not Found&quot;</span><span class="p">,</span> <span class="s1">&#39;text/html&#39;</span>
</span></pre></div>


            <div class="docstring"><p>Обрабатывает входящий HTTP-запрос.</p>

<p>Args:
    path (str): Путь запроса.
    method (str, optional): HTTP-метод запроса. По умолчанию 'GET'.
    data (dict, optional): Данные запроса. По умолчанию None.</p>

<p>Returns:
    tuple: Кортеж, содержащий статус-код, тело ответа и тип контента.</p>
</div>


                            </div>
                            <div id="DarkFream.render" class="classattr">
                                        <input id="DarkFream.render-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">render</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">template_name</span>, </span><span class="param"><span class="n">context</span><span class="o">=</span><span class="p">{}</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkFream.render-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream.render"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream.render-147"><a href="#DarkFream.render-147"><span class="linenos">147</span></a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{}):</span>
</span><span id="DarkFream.render-148"><a href="#DarkFream.render-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Рендерит шаблон с заданным контекстом.</span>
</span><span id="DarkFream.render-149"><a href="#DarkFream.render-149"><span class="linenos">149</span></a>
</span><span id="DarkFream.render-150"><a href="#DarkFream.render-150"><span class="linenos">150</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream.render-151"><a href="#DarkFream.render-151"><span class="linenos">151</span></a><span class="sd">            template_name (str): Имя шаблона для рендеринга.</span>
</span><span id="DarkFream.render-152"><a href="#DarkFream.render-152"><span class="linenos">152</span></a><span class="sd">            context (dict, optional): Контекст для шаблона. По умолчанию пустой словарь.</span>
</span><span id="DarkFream.render-153"><a href="#DarkFream.render-153"><span class="linenos">153</span></a>
</span><span id="DarkFream.render-154"><a href="#DarkFream.render-154"><span class="linenos">154</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream.render-155"><a href="#DarkFream.render-155"><span class="linenos">155</span></a><span class="sd">            str: Содержимое отрендеренного шаблона.</span>
</span><span id="DarkFream.render-156"><a href="#DarkFream.render-156"><span class="linenos">156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream.render-157"><a href="#DarkFream.render-157"><span class="linenos">157</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
</span><span id="DarkFream.render-158"><a href="#DarkFream.render-158"><span class="linenos">158</span></a>        <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Рендерит шаблон с заданным контекстом.</p>

<p>Args:
    template_name (str): Имя шаблона для рендеринга.
    context (dict, optional): Контекст для шаблона. По умолчанию пустой словарь.</p>

<p>Returns:
    str: Содержимое отрендеренного шаблона.</p>
</div>


                            </div>
                            <div id="DarkFream.render_code" class="classattr">
                                        <input id="DarkFream.render_code-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">render_code</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">status_code</span>, </span><span class="param"><span class="n">message</span>, </span><span class="param"><span class="n">template_name</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">context</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkFream.render_code-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream.render_code"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream.render_code-160"><a href="#DarkFream.render_code-160"><span class="linenos">160</span></a>    <span class="k">def</span> <span class="nf">render_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">template_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DarkFream.render_code-161"><a href="#DarkFream.render_code-161"><span class="linenos">161</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Рендерит ответ с заданным статусом и сообщением.</span>
</span><span id="DarkFream.render_code-162"><a href="#DarkFream.render_code-162"><span class="linenos">162</span></a>
</span><span id="DarkFream.render_code-163"><a href="#DarkFream.render_code-163"><span class="linenos">163</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream.render_code-164"><a href="#DarkFream.render_code-164"><span class="linenos">164</span></a><span class="sd">            status_code (int): Код статуса HTTP.</span>
</span><span id="DarkFream.render_code-165"><a href="#DarkFream.render_code-165"><span class="linenos">165</span></a><span class="sd">            message (str): Сообщение для отображения.</span>
</span><span id="DarkFream.render_code-166"><a href="#DarkFream.render_code-166"><span class="linenos">166</span></a><span class="sd">            template_name (str, optional): Имя шаблона для рендеринга. По умолчанию None.</span>
</span><span id="DarkFream.render_code-167"><a href="#DarkFream.render_code-167"><span class="linenos">167</span></a><span class="sd">            context (dict, optional): Контекст для шаблона. По умолчанию None.</span>
</span><span id="DarkFream.render_code-168"><a href="#DarkFream.render_code-168"><span class="linenos">168</span></a>
</span><span id="DarkFream.render_code-169"><a href="#DarkFream.render_code-169"><span class="linenos">169</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream.render_code-170"><a href="#DarkFream.render_code-170"><span class="linenos">170</span></a><span class="sd">            tuple: Кортеж, содержащий код статуса и сообщение, или отрендеренное содержимое.</span>
</span><span id="DarkFream.render_code-171"><a href="#DarkFream.render_code-171"><span class="linenos">171</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream.render_code-172"><a href="#DarkFream.render_code-172"><span class="linenos">172</span></a>        <span class="k">if</span> <span class="n">template_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DarkFream.render_code-173"><a href="#DarkFream.render_code-173"><span class="linenos">173</span></a>            <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">status_code</span><span class="p">,</span>
</span><span id="DarkFream.render_code-174"><a href="#DarkFream.render_code-174"><span class="linenos">174</span></a>                       <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">}</span>
</span><span id="DarkFream.render_code-175"><a href="#DarkFream.render_code-175"><span class="linenos">175</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_with_cache</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span><span id="DarkFream.render_code-176"><a href="#DarkFream.render_code-176"><span class="linenos">176</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">status_code</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Рендерит ответ с заданным статусом и сообщением.</p>

<p>Args:
    status_code (int): Код статуса HTTP.
    message (str): Сообщение для отображения.
    template_name (str, optional): Имя шаблона для рендеринга. По умолчанию None.
    context (dict, optional): Контекст для шаблона. По умолчанию None.</p>

<p>Returns:
    tuple: Кортеж, содержащий код статуса и сообщение, или отрендеренное содержимое.</p>
</div>


                            </div>
                            <div id="DarkFream.cache_template" class="classattr">
                                        <input id="DarkFream.cache_template-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">cache_template</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">template_name</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkFream.cache_template-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream.cache_template"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream.cache_template-178"><a href="#DarkFream.cache_template-178"><span class="linenos">178</span></a>    <span class="k">def</span> <span class="nf">cache_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">):</span>
</span><span id="DarkFream.cache_template-179"><a href="#DarkFream.cache_template-179"><span class="linenos">179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Кэширует шаблон для повторного использования.</span>
</span><span id="DarkFream.cache_template-180"><a href="#DarkFream.cache_template-180"><span class="linenos">180</span></a>
</span><span id="DarkFream.cache_template-181"><a href="#DarkFream.cache_template-181"><span class="linenos">181</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream.cache_template-182"><a href="#DarkFream.cache_template-182"><span class="linenos">182</span></a><span class="sd">            template_name (str): Имя шаблона для кэширования.</span>
</span><span id="DarkFream.cache_template-183"><a href="#DarkFream.cache_template-183"><span class="linenos">183</span></a>
</span><span id="DarkFream.cache_template-184"><a href="#DarkFream.cache_template-184"><span class="linenos">184</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream.cache_template-185"><a href="#DarkFream.cache_template-185"><span class="linenos">185</span></a><span class="sd">            Template: Отрендеренный шаблон.</span>
</span><span id="DarkFream.cache_template-186"><a href="#DarkFream.cache_template-186"><span class="linenos">186</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream.cache_template-187"><a href="#DarkFream.cache_template-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_template_cache&#39;</span><span class="p">):</span>
</span><span id="DarkFream.cache_template-188"><a href="#DarkFream.cache_template-188"><span class="linenos">188</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_template_cache</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DarkFream.cache_template-189"><a href="#DarkFream.cache_template-189"><span class="linenos">189</span></a>        <span class="k">if</span> <span class="n">template_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template_cache</span><span class="p">:</span>
</span><span id="DarkFream.cache_template-190"><a href="#DarkFream.cache_template-190"><span class="linenos">190</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_template_cache</span><span class="p">[</span><span class="n">template_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
</span><span id="DarkFream.cache_template-191"><a href="#DarkFream.cache_template-191"><span class="linenos">191</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template_cache</span><span class="p">[</span><span class="n">template_name</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Кэширует шаблон для повторного использования.</p>

<p>Args:
    template_name (str): Имя шаблона для кэширования.</p>

<p>Returns:
    Template: Отрендеренный шаблон.</p>
</div>


                            </div>
                            <div id="DarkFream.render_with_cache" class="classattr">
                                        <input id="DarkFream.render_with_cache-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">render_with_cache</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">template_name</span>, </span><span class="param"><span class="n">context</span><span class="o">=</span><span class="p">{}</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkFream.render_with_cache-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream.render_with_cache"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream.render_with_cache-193"><a href="#DarkFream.render_with_cache-193"><span class="linenos">193</span></a>    <span class="k">def</span> <span class="nf">render_with_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{}):</span>
</span><span id="DarkFream.render_with_cache-194"><a href="#DarkFream.render_with_cache-194"><span class="linenos">194</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Рендерит шаблон с кэшированием.</span>
</span><span id="DarkFream.render_with_cache-195"><a href="#DarkFream.render_with_cache-195"><span class="linenos">195</span></a>
</span><span id="DarkFream.render_with_cache-196"><a href="#DarkFream.render_with_cache-196"><span class="linenos">196</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream.render_with_cache-197"><a href="#DarkFream.render_with_cache-197"><span class="linenos">197</span></a><span class="sd">            template_name (str): Имя шаблона для рендеринга.</span>
</span><span id="DarkFream.render_with_cache-198"><a href="#DarkFream.render_with_cache-198"><span class="linenos">198</span></a><span class="sd">            context (dict, optional): Контекст для шаблона. По умолчанию пустой словарь.</span>
</span><span id="DarkFream.render_with_cache-199"><a href="#DarkFream.render_with_cache-199"><span class="linenos">199</span></a>
</span><span id="DarkFream.render_with_cache-200"><a href="#DarkFream.render_with_cache-200"><span class="linenos">200</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream.render_with_cache-201"><a href="#DarkFream.render_with_cache-201"><span class="linenos">201</span></a><span class="sd">            str: Содержимое отрендеренного шаблона.</span>
</span><span id="DarkFream.render_with_cache-202"><a href="#DarkFream.render_with_cache-202"><span class="linenos">202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream.render_with_cache-203"><a href="#DarkFream.render_with_cache-203"><span class="linenos">203</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
</span><span id="DarkFream.render_with_cache-204"><a href="#DarkFream.render_with_cache-204"><span class="linenos">204</span></a>        <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Рендерит шаблон с кэшированием.</p>

<p>Args:
    template_name (str): Имя шаблона для рендеринга.
    context (dict, optional): Контекст для шаблона. По умолчанию пустой словарь.</p>

<p>Returns:
    str: Содержимое отрендеренного шаблона.</p>
</div>


                            </div>
                            <div id="DarkFream.redirect" class="classattr">
                                        <input id="DarkFream.redirect-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">redirect</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span>, </span><span class="param"><span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkFream.redirect-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream.redirect"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream.redirect-206"><a href="#DarkFream.redirect-206"><span class="linenos">206</span></a>    <span class="k">def</span> <span class="nf">redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">):</span>
</span><span id="DarkFream.redirect-207"><a href="#DarkFream.redirect-207"><span class="linenos">207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Перенаправляет на указанный путь.</span>
</span><span id="DarkFream.redirect-208"><a href="#DarkFream.redirect-208"><span class="linenos">208</span></a>
</span><span id="DarkFream.redirect-209"><a href="#DarkFream.redirect-209"><span class="linenos">209</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream.redirect-210"><a href="#DarkFream.redirect-210"><span class="linenos">210</span></a><span class="sd">            path (str): Путь для перенаправления.</span>
</span><span id="DarkFream.redirect-211"><a href="#DarkFream.redirect-211"><span class="linenos">211</span></a><span class="sd">            method (str, optional): HTTP-метод для перенаправления. По умолчанию &#39;GET&#39;.</span>
</span><span id="DarkFream.redirect-212"><a href="#DarkFream.redirect-212"><span class="linenos">212</span></a>
</span><span id="DarkFream.redirect-213"><a href="#DarkFream.redirect-213"><span class="linenos">213</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream.redirect-214"><a href="#DarkFream.redirect-214"><span class="linenos">214</span></a><span class="sd">            tuple: Кортеж, содержащий код статуса, пустое тело и заголовки для перенаправления.</span>
</span><span id="DarkFream.redirect-215"><a href="#DarkFream.redirect-215"><span class="linenos">215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream.redirect-216"><a href="#DarkFream.redirect-216"><span class="linenos">216</span></a>        <span class="k">return</span> <span class="p">(</span><span class="mi">302</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span id="DarkFream.redirect-217"><a href="#DarkFream.redirect-217"><span class="linenos">217</span></a>            <span class="s1">&#39;Location&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
</span><span id="DarkFream.redirect-218"><a href="#DarkFream.redirect-218"><span class="linenos">218</span></a>            <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html&#39;</span>
</span><span id="DarkFream.redirect-219"><a href="#DarkFream.redirect-219"><span class="linenos">219</span></a>        <span class="p">})</span>
</span></pre></div>


            <div class="docstring"><p>Перенаправляет на указанный путь.</p>

<p>Args:
    path (str): Путь для перенаправления.
    method (str, optional): HTTP-метод для перенаправления. По умолчанию 'GET'.</p>

<p>Returns:
    tuple: Кортеж, содержащий код статуса, пустое тело и заголовки для перенаправления.</p>
</div>


                            </div>
                            <div id="DarkFream.api_route" class="classattr">
                                        <input id="DarkFream.api_route-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">api_route</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span>, </span><span class="param"><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkFream.api_route-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream.api_route"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream.api_route-221"><a href="#DarkFream.api_route-221"><span class="linenos">221</span></a>    <span class="k">def</span> <span class="nf">api_route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]):</span>
</span><span id="DarkFream.api_route-222"><a href="#DarkFream.api_route-222"><span class="linenos">222</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Декоратор для регистрации API маршрута.</span>
</span><span id="DarkFream.api_route-223"><a href="#DarkFream.api_route-223"><span class="linenos">223</span></a>
</span><span id="DarkFream.api_route-224"><a href="#DarkFream.api_route-224"><span class="linenos">224</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream.api_route-225"><a href="#DarkFream.api_route-225"><span class="linenos">225</span></a><span class="sd">            path (str): Путь для API маршрута.</span>
</span><span id="DarkFream.api_route-226"><a href="#DarkFream.api_route-226"><span class="linenos">226</span></a><span class="sd">            methods (list, optional): Список HTTP-методов, поддерживаемых маршрутом. По умолчанию [&#39;GET&#39;].</span>
</span><span id="DarkFream.api_route-227"><a href="#DarkFream.api_route-227"><span class="linenos">227</span></a>
</span><span id="DarkFream.api_route-228"><a href="#DarkFream.api_route-228"><span class="linenos">228</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream.api_route-229"><a href="#DarkFream.api_route-229"><span class="linenos">229</span></a><span class="sd">            callable: Обернутый обработчик API маршрута.</span>
</span><span id="DarkFream.api_route-230"><a href="#DarkFream.api_route-230"><span class="linenos">230</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream.api_route-231"><a href="#DarkFream.api_route-231"><span class="linenos">231</span></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="DarkFream.api_route-232"><a href="#DarkFream.api_route-232"><span class="linenos">232</span></a>            <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">:</span>
</span><span id="DarkFream.api_route-233"><a href="#DarkFream.api_route-233"><span class="linenos">233</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DarkFream.api_route-234"><a href="#DarkFream.api_route-234"><span class="linenos">234</span></a>            <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
</span><span id="DarkFream.api_route-235"><a href="#DarkFream.api_route-235"><span class="linenos">235</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_handler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="DarkFream.api_route-236"><a href="#DarkFream.api_route-236"><span class="linenos">236</span></a>            <span class="k">return</span> <span class="n">func</span>
</span><span id="DarkFream.api_route-237"><a href="#DarkFream.api_route-237"><span class="linenos">237</span></a>        <span class="k">return</span> <span class="n">wrapper</span>
</span></pre></div>


            <div class="docstring"><p>Декоратор для регистрации API маршрута.</p>

<p>Args:
    path (str): Путь для API маршрута.
    methods (list, optional): Список HTTP-методов, поддерживаемых маршрутом. По умолчанию ['GET'].</p>

<p>Returns:
    callable: Обернутый обработчик API маршрута.</p>
</div>


                            </div>
                            <div id="DarkFream.api_handler" class="classattr">
                                        <input id="DarkFream.api_handler-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">api_handler</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">func</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkFream.api_handler-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream.api_handler"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream.api_handler-239"><a href="#DarkFream.api_handler-239"><span class="linenos">239</span></a>    <span class="k">def</span> <span class="nf">api_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
</span><span id="DarkFream.api_handler-240"><a href="#DarkFream.api_handler-240"><span class="linenos">240</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Обработчик для API маршрута, обрабатывающий ошибки.</span>
</span><span id="DarkFream.api_handler-241"><a href="#DarkFream.api_handler-241"><span class="linenos">241</span></a>
</span><span id="DarkFream.api_handler-242"><a href="#DarkFream.api_handler-242"><span class="linenos">242</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream.api_handler-243"><a href="#DarkFream.api_handler-243"><span class="linenos">243</span></a><span class="sd">            func (callable): Обработчик API.</span>
</span><span id="DarkFream.api_handler-244"><a href="#DarkFream.api_handler-244"><span class="linenos">244</span></a>
</span><span id="DarkFream.api_handler-245"><a href="#DarkFream.api_handler-245"><span class="linenos">245</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream.api_handler-246"><a href="#DarkFream.api_handler-246"><span class="linenos">246</span></a><span class="sd">            callable: Обернутый обработчик с обработкой ошибок.</span>
</span><span id="DarkFream.api_handler-247"><a href="#DarkFream.api_handler-247"><span class="linenos">247</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream.api_handler-248"><a href="#DarkFream.api_handler-248"><span class="linenos">248</span></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="DarkFream.api_handler-249"><a href="#DarkFream.api_handler-249"><span class="linenos">249</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DarkFream.api_handler-250"><a href="#DarkFream.api_handler-250"><span class="linenos">250</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="DarkFream.api_handler-251"><a href="#DarkFream.api_handler-251"><span class="linenos">251</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span><span id="DarkFream.api_handler-252"><a href="#DarkFream.api_handler-252"><span class="linenos">252</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DarkFream.api_handler-253"><a href="#DarkFream.api_handler-253"><span class="linenos">253</span></a>                <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="DarkFream.api_handler-254"><a href="#DarkFream.api_handler-254"><span class="linenos">254</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>
</span><span id="DarkFream.api_handler-255"><a href="#DarkFream.api_handler-255"><span class="linenos">255</span></a>        <span class="k">return</span> <span class="n">wrapper</span>
</span></pre></div>


            <div class="docstring"><p>Обработчик для API маршрута, обрабатывающий ошибки.</p>

<p>Args:
    func (callable): Обработчик API.</p>

<p>Returns:
    callable: Обернутый обработчик с обработкой ошибок.</p>
</div>


                            </div>
                            <div id="DarkFream.json_response" class="classattr">
                                        <input id="DarkFream.json_response-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">json_response</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">status_code</span>, </span><span class="param"><span class="n">data</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkFream.json_response-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream.json_response"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream.json_response-256"><a href="#DarkFream.json_response-256"><span class="linenos">256</span></a>    <span class="k">def</span> <span class="nf">json_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="DarkFream.json_response-257"><a href="#DarkFream.json_response-257"><span class="linenos">257</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Создает JSON-ответ с заданным статусом и данными.</span>
</span><span id="DarkFream.json_response-258"><a href="#DarkFream.json_response-258"><span class="linenos">258</span></a>
</span><span id="DarkFream.json_response-259"><a href="#DarkFream.json_response-259"><span class="linenos">259</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream.json_response-260"><a href="#DarkFream.json_response-260"><span class="linenos">260</span></a><span class="sd">            status_code (int): Код статуса HTTP.</span>
</span><span id="DarkFream.json_response-261"><a href="#DarkFream.json_response-261"><span class="linenos">261</span></a><span class="sd">            data (dict): Данные, которые будут включены в JSON-ответ.</span>
</span><span id="DarkFream.json_response-262"><a href="#DarkFream.json_response-262"><span class="linenos">262</span></a>
</span><span id="DarkFream.json_response-263"><a href="#DarkFream.json_response-263"><span class="linenos">263</span></a><span class="sd">        Returns:</span>
</span><span id="DarkFream.json_response-264"><a href="#DarkFream.json_response-264"><span class="linenos">264</span></a><span class="sd">            tuple: Кортеж, содержащий код статуса, JSON-строку и заголовки для ответа.</span>
</span><span id="DarkFream.json_response-265"><a href="#DarkFream.json_response-265"><span class="linenos">265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream.json_response-266"><a href="#DarkFream.json_response-266"><span class="linenos">266</span></a>        <span class="kn">import</span> <span class="nn">json</span>
</span><span id="DarkFream.json_response-267"><a href="#DarkFream.json_response-267"><span class="linenos">267</span></a>        <span class="n">response_body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="DarkFream.json_response-268"><a href="#DarkFream.json_response-268"><span class="linenos">268</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DarkFream.json_response-269"><a href="#DarkFream.json_response-269"><span class="linenos">269</span></a>            <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span id="DarkFream.json_response-270"><a href="#DarkFream.json_response-270"><span class="linenos">270</span></a>            <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span><span id="DarkFream.json_response-271"><a href="#DarkFream.json_response-271"><span class="linenos">271</span></a>            <span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">:</span> <span class="s1">&#39;GET, POST, OPTIONS&#39;</span><span class="p">,</span>
</span><span id="DarkFream.json_response-272"><a href="#DarkFream.json_response-272"><span class="linenos">272</span></a>            <span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">:</span> <span class="s1">&#39;Content-Type&#39;</span>
</span><span id="DarkFream.json_response-273"><a href="#DarkFream.json_response-273"><span class="linenos">273</span></a>        <span class="p">}</span>
</span><span id="DarkFream.json_response-274"><a href="#DarkFream.json_response-274"><span class="linenos">274</span></a>        <span class="k">return</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span><span class="p">,</span> <span class="n">headers</span>
</span></pre></div>


            <div class="docstring"><p>Создает JSON-ответ с заданным статусом и данными.</p>

<p>Args:
    status_code (int): Код статуса HTTP.
    data (dict): Данные, которые будут включены в JSON-ответ.</p>

<p>Returns:
    tuple: Кортеж, содержащий код статуса, JSON-строку и заголовки для ответа.</p>
</div>


                            </div>
                            <div id="DarkFream.run" class="classattr">
                                        <input id="DarkFream.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">server_address</span><span class="o">=</span><span class="s1">&#39;&#39;</span>, </span><span class="param"><span class="n">port</span><span class="o">=</span><span class="mi">8000</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkFream.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream.run-277"><a href="#DarkFream.run-277"><span class="linenos">277</span></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_address</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">):</span>
</span><span id="DarkFream.run-278"><a href="#DarkFream.run-278"><span class="linenos">278</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Запускает HTTP сервер.</span>
</span><span id="DarkFream.run-279"><a href="#DarkFream.run-279"><span class="linenos">279</span></a>
</span><span id="DarkFream.run-280"><a href="#DarkFream.run-280"><span class="linenos">280</span></a><span class="sd">        Args:</span>
</span><span id="DarkFream.run-281"><a href="#DarkFream.run-281"><span class="linenos">281</span></a><span class="sd">            server_address (str): Адрес сервера. По умолчанию пустая строка.</span>
</span><span id="DarkFream.run-282"><a href="#DarkFream.run-282"><span class="linenos">282</span></a><span class="sd">            port (int): Порт, на котором будет запущен сервер. По умолчанию 8000.</span>
</span><span id="DarkFream.run-283"><a href="#DarkFream.run-283"><span class="linenos">283</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkFream.run-284"><a href="#DarkFream.run-284"><span class="linenos">284</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_plugins</span><span class="p">()</span>
</span><span id="DarkFream.run-285"><a href="#DarkFream.run-285"><span class="linenos">285</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DarkFream.run-286"><a href="#DarkFream.run-286"><span class="linenos">286</span></a>            <span class="n">handler</span> <span class="o">=</span> <span class="n">get_handler</span><span class="p">()</span> <span class="ow">or</span> <span class="n">DarkHandler</span>
</span><span id="DarkFream.run-287"><a href="#DarkFream.run-287"><span class="linenos">287</span></a>            <span class="n">httpd</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">((</span><span class="n">server_address</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">handler</span><span class="p">)</span>
</span><span id="DarkFream.run-288"><a href="#DarkFream.run-288"><span class="linenos">288</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Serving on port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
</span><span id="DarkFream.run-289"><a href="#DarkFream.run-289"><span class="linenos">289</span></a>            <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</span><span id="DarkFream.run-290"><a href="#DarkFream.run-290"><span class="linenos">290</span></a>        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="DarkFream.run-291"><a href="#DarkFream.run-291"><span class="linenos">291</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Server stopped&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Запускает HTTP сервер.</p>

<p>Args:
    server_address (str): Адрес сервера. По умолчанию пустая строка.
    port (int): Порт, на котором будет запущен сервер. По умолчанию 8000.</p>
</div>


                            </div>
                            <div id="DarkFream.send_response" class="classattr">
                                        <input id="DarkFream.send_response-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">async def</span>
        <span class="name">send_response</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">send</span>, </span><span class="param"><span class="n">response</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkFream.send_response-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkFream.send_response"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkFream.send_response-303"><a href="#DarkFream.send_response-303"><span class="linenos">303</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">send_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">send</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
</span><span id="DarkFream.send_response-304"><a href="#DarkFream.send_response-304"><span class="linenos">304</span></a>        <span class="k">await</span> <span class="n">send</span><span class="p">({</span>
</span><span id="DarkFream.send_response-305"><a href="#DarkFream.send_response-305"><span class="linenos">305</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;http.response.start&quot;</span><span class="p">,</span>
</span><span id="DarkFream.send_response-306"><a href="#DarkFream.send_response-306"><span class="linenos">306</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="DarkFream.send_response-307"><a href="#DarkFream.send_response-307"><span class="linenos">307</span></a>            <span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="n">k</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">v</span><span class="o">.</span><span class="n">encode</span><span class="p">()]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;headers&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span>
</span><span id="DarkFream.send_response-308"><a href="#DarkFream.send_response-308"><span class="linenos">308</span></a>        <span class="p">})</span>
</span><span id="DarkFream.send_response-309"><a href="#DarkFream.send_response-309"><span class="linenos">309</span></a>        <span class="k">await</span> <span class="n">send</span><span class="p">({</span>
</span><span id="DarkFream.send_response-310"><a href="#DarkFream.send_response-310"><span class="linenos">310</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;http.response.body&quot;</span><span class="p">,</span>
</span><span id="DarkFream.send_response-311"><a href="#DarkFream.send_response-311"><span class="linenos">311</span></a>            <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">)</span> <span class="k">else</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
</span><span id="DarkFream.send_response-312"><a href="#DarkFream.send_response-312"><span class="linenos">312</span></a>        <span class="p">})</span>
</span></pre></div>




                            </div>
                </section>
                <section id="DarkHandler">
                            <input id="DarkHandler-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">

    <span class="def">class</span>
    <span class="name">DarkHandler</span><wbr>(<span class="base">http.server.BaseHTTPRequestHandler</span>):

                <label class="view-source-button" for="DarkHandler-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkHandler"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkHandler-315"><a href="#DarkHandler-315"><span class="linenos">315</span></a><span class="k">class</span> <span class="nc">DarkHandler</span><span class="p">(</span><span class="n">BaseHTTPRequestHandler</span><span class="p">):</span>
</span><span id="DarkHandler-316"><a href="#DarkHandler-316"><span class="linenos">316</span></a>    <span class="n">darkfream</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DarkHandler-317"><a href="#DarkHandler-317"><span class="linenos">317</span></a>
</span><span id="DarkHandler-318"><a href="#DarkHandler-318"><span class="linenos">318</span></a>    <span class="nd">@classmethod</span>
</span><span id="DarkHandler-319"><a href="#DarkHandler-319"><span class="linenos">319</span></a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">darkfream</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DarkHandler-320"><a href="#DarkHandler-320"><span class="linenos">320</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Инициализирует DarkHandler с экземпляром DarkFream.</span>
</span><span id="DarkHandler-321"><a href="#DarkHandler-321"><span class="linenos">321</span></a>
</span><span id="DarkHandler-322"><a href="#DarkHandler-322"><span class="linenos">322</span></a><span class="sd">        Args:</span>
</span><span id="DarkHandler-323"><a href="#DarkHandler-323"><span class="linenos">323</span></a><span class="sd">            darkfream (DarkFream, optional): Экземпляр DarkFream. Если не указан, создается новый экземпляр.</span>
</span><span id="DarkHandler-324"><a href="#DarkHandler-324"><span class="linenos">324</span></a>
</span><span id="DarkHandler-325"><a href="#DarkHandler-325"><span class="linenos">325</span></a><span class="sd">        Returns:</span>
</span><span id="DarkHandler-326"><a href="#DarkHandler-326"><span class="linenos">326</span></a><span class="sd">            DarkFream: Экземпляр DarkFream, используемый в обработчике.</span>
</span><span id="DarkHandler-327"><a href="#DarkHandler-327"><span class="linenos">327</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkHandler-328"><a href="#DarkHandler-328"><span class="linenos">328</span></a>        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">darkfream</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DarkHandler-329"><a href="#DarkHandler-329"><span class="linenos">329</span></a>            <span class="k">if</span> <span class="n">darkfream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DarkHandler-330"><a href="#DarkHandler-330"><span class="linenos">330</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">darkfream</span> <span class="o">=</span> <span class="n">darkfream</span>
</span><span id="DarkHandler-331"><a href="#DarkHandler-331"><span class="linenos">331</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DarkHandler-332"><a href="#DarkHandler-332"><span class="linenos">332</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">darkfream</span> <span class="o">=</span> <span class="n">DarkFream</span><span class="p">()</span>
</span><span id="DarkHandler-333"><a href="#DarkHandler-333"><span class="linenos">333</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">darkfream</span>
</span><span id="DarkHandler-334"><a href="#DarkHandler-334"><span class="linenos">334</span></a>
</span><span id="DarkHandler-335"><a href="#DarkHandler-335"><span class="linenos">335</span></a>    <span class="k">def</span> <span class="nf">do_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DarkHandler-336"><a href="#DarkHandler-336"><span class="linenos">336</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Обрабатывает HTTP POST запрос.</span>
</span><span id="DarkHandler-337"><a href="#DarkHandler-337"><span class="linenos">337</span></a>
</span><span id="DarkHandler-338"><a href="#DarkHandler-338"><span class="linenos">338</span></a><span class="sd">        Читает данные из запроса, обрабатывает их и возвращает ответ клиенту.</span>
</span><span id="DarkHandler-339"><a href="#DarkHandler-339"><span class="linenos">339</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkHandler-340"><a href="#DarkHandler-340"><span class="linenos">340</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DarkHandler-341"><a href="#DarkHandler-341"><span class="linenos">341</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="DarkHandler-342"><a href="#DarkHandler-342"><span class="linenos">342</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DarkHandler-343"><a href="#DarkHandler-343"><span class="linenos">343</span></a>            <span class="n">content_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">])</span>
</span><span id="DarkHandler-344"><a href="#DarkHandler-344"><span class="linenos">344</span></a>            <span class="n">post_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">content_length</span><span class="p">)</span>
</span><span id="DarkHandler-345"><a href="#DarkHandler-345"><span class="linenos">345</span></a>            <span class="n">content_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="DarkHandler-346"><a href="#DarkHandler-346"><span class="linenos">346</span></a>
</span><span id="DarkHandler-347"><a href="#DarkHandler-347"><span class="linenos">347</span></a>            <span class="k">if</span> <span class="s1">&#39;application/json&#39;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="DarkHandler-348"><a href="#DarkHandler-348"><span class="linenos">348</span></a>                <span class="kn">import</span> <span class="nn">json</span>
</span><span id="DarkHandler-349"><a href="#DarkHandler-349"><span class="linenos">349</span></a>                <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">post_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="DarkHandler-350"><a href="#DarkHandler-350"><span class="linenos">350</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DarkHandler-351"><a href="#DarkHandler-351"><span class="linenos">351</span></a>                <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">parse_qs</span><span class="p">(</span><span class="n">post_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="DarkHandler-352"><a href="#DarkHandler-352"><span class="linenos">352</span></a>
</span><span id="DarkHandler-353"><a href="#DarkHandler-353"><span class="linenos">353</span></a>            <span class="n">request_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DarkHandler-354"><a href="#DarkHandler-354"><span class="linenos">354</span></a>                <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span id="DarkHandler-355"><a href="#DarkHandler-355"><span class="linenos">355</span></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="DarkHandler-356"><a href="#DarkHandler-356"><span class="linenos">356</span></a>                <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">),</span>
</span><span id="DarkHandler-357"><a href="#DarkHandler-357"><span class="linenos">357</span></a>                <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">parsed_data</span><span class="p">,</span>
</span><span id="DarkHandler-358"><a href="#DarkHandler-358"><span class="linenos">358</span></a>                <span class="s1">&#39;session&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_session</span><span class="p">()</span>
</span><span id="DarkHandler-359"><a href="#DarkHandler-359"><span class="linenos">359</span></a>            <span class="p">}</span>
</span><span id="DarkHandler-360"><a href="#DarkHandler-360"><span class="linenos">360</span></a>
</span><span id="DarkHandler-361"><a href="#DarkHandler-361"><span class="linenos">361</span></a>            <span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">content_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">request_data</span><span class="p">)</span>
</span><span id="DarkHandler-362"><a href="#DarkHandler-362"><span class="linenos">362</span></a>
</span><span id="DarkHandler-363"><a href="#DarkHandler-363"><span class="linenos">363</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span>
</span><span id="DarkHandler-364"><a href="#DarkHandler-364"><span class="linenos">364</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DarkHandler-365"><a href="#DarkHandler-365"><span class="linenos">365</span></a>                <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">content_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DarkHandler-366"><a href="#DarkHandler-366"><span class="linenos">366</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="DarkHandler-367"><a href="#DarkHandler-367"><span class="linenos">367</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DarkHandler-368"><a href="#DarkHandler-368"><span class="linenos">368</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
</span><span id="DarkHandler-369"><a href="#DarkHandler-369"><span class="linenos">369</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</span><span id="DarkHandler-370"><a href="#DarkHandler-370"><span class="linenos">370</span></a>
</span><span id="DarkHandler-371"><a href="#DarkHandler-371"><span class="linenos">371</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;Location&#39;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="DarkHandler-372"><a href="#DarkHandler-372"><span class="linenos">372</span></a>                <span class="k">return</span>
</span><span id="DarkHandler-373"><a href="#DarkHandler-373"><span class="linenos">373</span></a>
</span><span id="DarkHandler-374"><a href="#DarkHandler-374"><span class="linenos">374</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="DarkHandler-375"><a href="#DarkHandler-375"><span class="linenos">375</span></a>
</span><span id="DarkHandler-376"><a href="#DarkHandler-376"><span class="linenos">376</span></a>        <span class="k">except</span> <span class="ne">ConnectionAbortedError</span><span class="p">:</span>
</span><span id="DarkHandler-377"><a href="#DarkHandler-377"><span class="linenos">377</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Client connection aborted&#39;</span><span class="p">)</span>
</span><span id="DarkHandler-378"><a href="#DarkHandler-378"><span class="linenos">378</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DarkHandler-379"><a href="#DarkHandler-379"><span class="linenos">379</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error handling POST request: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="DarkHandler-380"><a href="#DarkHandler-380"><span class="linenos">380</span></a>
</span><span id="DarkHandler-381"><a href="#DarkHandler-381"><span class="linenos">381</span></a>    <span class="k">def</span> <span class="nf">do_OPTIONS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DarkHandler-382"><a href="#DarkHandler-382"><span class="linenos">382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Обрабатывает HTTP OPTIONS запрос.</span>
</span><span id="DarkHandler-383"><a href="#DarkHandler-383"><span class="linenos">383</span></a>
</span><span id="DarkHandler-384"><a href="#DarkHandler-384"><span class="linenos">384</span></a><span class="sd">        Возвращает заголовки, позволяющие клиентам узнать, какие методы поддерживаются сервером.</span>
</span><span id="DarkHandler-385"><a href="#DarkHandler-385"><span class="linenos">385</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkHandler-386"><a href="#DarkHandler-386"><span class="linenos">386</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DarkHandler-387"><a href="#DarkHandler-387"><span class="linenos">387</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="DarkHandler-388"><a href="#DarkHandler-388"><span class="linenos">388</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DarkHandler-389"><a href="#DarkHandler-389"><span class="linenos">389</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">204</span><span class="p">)</span>
</span><span id="DarkHandler-390"><a href="#DarkHandler-390"><span class="linenos">390</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="DarkHandler-391"><a href="#DarkHandler-391"><span class="linenos">391</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">,</span> <span class="s1">&#39;GET, POST, OPTIONS&#39;</span><span class="p">)</span>
</span><span id="DarkHandler-392"><a href="#DarkHandler-392"><span class="linenos">392</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">)</span>
</span><span id="DarkHandler-393"><a href="#DarkHandler-393"><span class="linenos">393</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Credentials&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span>
</span><span id="DarkHandler-394"><a href="#DarkHandler-394"><span class="linenos">394</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</span><span id="DarkHandler-395"><a href="#DarkHandler-395"><span class="linenos">395</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DarkHandler-396"><a href="#DarkHandler-396"><span class="linenos">396</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error handling OPTIONS request: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="DarkHandler-397"><a href="#DarkHandler-397"><span class="linenos">397</span></a>
</span><span id="DarkHandler-398"><a href="#DarkHandler-398"><span class="linenos">398</span></a>    <span class="k">def</span> <span class="nf">parse_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DarkHandler-399"><a href="#DarkHandler-399"><span class="linenos">399</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Парсит данные сессии из заголовка Cookie.</span>
</span><span id="DarkHandler-400"><a href="#DarkHandler-400"><span class="linenos">400</span></a>
</span><span id="DarkHandler-401"><a href="#DarkHandler-401"><span class="linenos">401</span></a><span class="sd">        Returns:</span>
</span><span id="DarkHandler-402"><a href="#DarkHandler-402"><span class="linenos">402</span></a><span class="sd">            dict: Данные сессии, если они существуют, иначе пустой словарь.</span>
</span><span id="DarkHandler-403"><a href="#DarkHandler-403"><span class="linenos">403</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkHandler-404"><a href="#DarkHandler-404"><span class="linenos">404</span></a>        <span class="n">session_cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Cookie&#39;</span><span class="p">)</span>
</span><span id="DarkHandler-405"><a href="#DarkHandler-405"><span class="linenos">405</span></a>        <span class="k">if</span> <span class="n">session_cookie</span><span class="p">:</span>
</span><span id="DarkHandler-406"><a href="#DarkHandler-406"><span class="linenos">406</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DarkHandler-407"><a href="#DarkHandler-407"><span class="linenos">407</span></a>                <span class="n">session_data</span> <span class="o">=</span> <span class="n">session_cookie</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;session=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DarkHandler-408"><a href="#DarkHandler-408"><span class="linenos">408</span></a>                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">session_data</span><span class="p">)</span>
</span><span id="DarkHandler-409"><a href="#DarkHandler-409"><span class="linenos">409</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="DarkHandler-410"><a href="#DarkHandler-410"><span class="linenos">410</span></a>                <span class="k">pass</span>
</span><span id="DarkHandler-411"><a href="#DarkHandler-411"><span class="linenos">411</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="DarkHandler-412"><a href="#DarkHandler-412"><span class="linenos">412</span></a>
</span><span id="DarkHandler-413"><a href="#DarkHandler-413"><span class="linenos">413</span></a>    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DarkHandler-414"><a href="#DarkHandler-414"><span class="linenos">414</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Обрабатывает HTTP GET запрос.</span>
</span><span id="DarkHandler-415"><a href="#DarkHandler-415"><span class="linenos">415</span></a>
</span><span id="DarkHandler-416"><a href="#DarkHandler-416"><span class="linenos">416</span></a><span class="sd">        Возвращает ответ клиенту в зависимости от запрашиваемого ресурса.</span>
</span><span id="DarkHandler-417"><a href="#DarkHandler-417"><span class="linenos">417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkHandler-418"><a href="#DarkHandler-418"><span class="linenos">418</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DarkHandler-419"><a href="#DarkHandler-419"><span class="linenos">419</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="DarkHandler-420"><a href="#DarkHandler-420"><span class="linenos">420</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DarkHandler-421"><a href="#DarkHandler-421"><span class="linenos">421</span></a>            <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span><span class="o">.</span><span class="n">static_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DarkHandler-422"><a href="#DarkHandler-422"><span class="linenos">422</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
</span><span id="DarkHandler-423"><a href="#DarkHandler-423"><span class="linenos">423</span></a>                    <span class="n">content</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">content_type</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">Request</span><span class="p">({</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">},</span> <span class="kc">None</span><span class="p">))</span>
</span><span id="DarkHandler-424"><a href="#DarkHandler-424"><span class="linenos">424</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span>
</span><span id="DarkHandler-425"><a href="#DarkHandler-425"><span class="linenos">425</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
</span><span id="DarkHandler-426"><a href="#DarkHandler-426"><span class="linenos">426</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</span><span id="DarkHandler-427"><a href="#DarkHandler-427"><span class="linenos">427</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DarkHandler-428"><a href="#DarkHandler-428"><span class="linenos">428</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="DarkHandler-429"><a href="#DarkHandler-429"><span class="linenos">429</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DarkHandler-430"><a href="#DarkHandler-430"><span class="linenos">430</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="DarkHandler-431"><a href="#DarkHandler-431"><span class="linenos">431</span></a>                    <span class="k">return</span>
</span><span id="DarkHandler-432"><a href="#DarkHandler-432"><span class="linenos">432</span></a>
</span><span id="DarkHandler-433"><a href="#DarkHandler-433"><span class="linenos">433</span></a>            <span class="n">request_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DarkHandler-434"><a href="#DarkHandler-434"><span class="linenos">434</span></a>                <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
</span><span id="DarkHandler-435"><a href="#DarkHandler-435"><span class="linenos">435</span></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="DarkHandler-436"><a href="#DarkHandler-436"><span class="linenos">436</span></a>                <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">),</span>
</span><span id="DarkHandler-437"><a href="#DarkHandler-437"><span class="linenos">437</span></a>                <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DarkHandler-438"><a href="#DarkHandler-438"><span class="linenos">438</span></a>                <span class="s1">&#39;session&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_session</span><span class="p">()</span>
</span><span id="DarkHandler-439"><a href="#DarkHandler-439"><span class="linenos">439</span></a>            <span class="p">}</span>
</span><span id="DarkHandler-440"><a href="#DarkHandler-440"><span class="linenos">440</span></a>
</span><span id="DarkHandler-441"><a href="#DarkHandler-441"><span class="linenos">441</span></a>            <span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">content_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span>
</span><span id="DarkHandler-442"><a href="#DarkHandler-442"><span class="linenos">442</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">request_data</span><span class="p">)</span>
</span><span id="DarkHandler-443"><a href="#DarkHandler-443"><span class="linenos">443</span></a>
</span><span id="DarkHandler-444"><a href="#DarkHandler-444"><span class="linenos">444</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span>
</span><span id="DarkHandler-445"><a href="#DarkHandler-445"><span class="linenos">445</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DarkHandler-446"><a href="#DarkHandler-446"><span class="linenos">446</span></a>                <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">content_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DarkHandler-447"><a href="#DarkHandler-447"><span class="linenos">447</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="DarkHandler-448"><a href="#DarkHandler-448"><span class="linenos">448</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DarkHandler-449"><a href="#DarkHandler-449"><span class="linenos">449</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span>
</span><span id="DarkHandler-450"><a href="#DarkHandler-450"><span class="linenos">450</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DarkHandler-451"><a href="#DarkHandler-451"><span class="linenos">451</span></a>                <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">content_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DarkHandler-452"><a href="#DarkHandler-452"><span class="linenos">452</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="DarkHandler-453"><a href="#DarkHandler-453"><span class="linenos">453</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DarkHandler-454"><a href="#DarkHandler-454"><span class="linenos">454</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
</span><span id="DarkHandler-455"><a href="#DarkHandler-455"><span class="linenos">455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</span><span id="DarkHandler-456"><a href="#DarkHandler-456"><span class="linenos">456</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="DarkHandler-457"><a href="#DarkHandler-457"><span class="linenos">457</span></a>
</span><span id="DarkHandler-458"><a href="#DarkHandler-458"><span class="linenos">458</span></a>        <span class="k">except</span> <span class="ne">ConnectionAbortedError</span><span class="p">:</span>
</span><span id="DarkHandler-459"><a href="#DarkHandler-459"><span class="linenos">459</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Client connection aborted&#39;</span><span class="p">)</span>
</span><span id="DarkHandler-460"><a href="#DarkHandler-460"><span class="linenos">460</span></a>
</span><span id="DarkHandler-461"><a href="#DarkHandler-461"><span class="linenos">461</span></a>    <span class="k">def</span> <span class="nf">log_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="DarkHandler-462"><a href="#DarkHandler-462"><span class="linenos">462</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Логирует сообщения о запросах.</span>
</span><span id="DarkHandler-463"><a href="#DarkHandler-463"><span class="linenos">463</span></a>
</span><span id="DarkHandler-464"><a href="#DarkHandler-464"><span class="linenos">464</span></a><span class="sd">        Args:</span>
</span><span id="DarkHandler-465"><a href="#DarkHandler-465"><span class="linenos">465</span></a><span class="sd">            format (str): Формат сообщения.</span>
</span><span id="DarkHandler-466"><a href="#DarkHandler-466"><span class="linenos">466</span></a><span class="sd">            *args: Дополнительные аргументы для форматирования сообщения.</span>
</span><span id="DarkHandler-467"><a href="#DarkHandler-467"><span class="linenos">467</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkHandler-468"><a href="#DarkHandler-468"><span class="linenos">468</span></a>        <span class="n">client_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X-Forwarded-For&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X-Real-IP&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="DarkHandler-469"><a href="#DarkHandler-469"><span class="linenos">469</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">client_ip</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> - - [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">log_date_time_string</span><span class="p">()</span><span class="si">}</span><span class="s1">] - %s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">format</span> <span class="o">%</span> <span class="n">args</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>HTTP request handler base class.</p>

<p>The following explanation of HTTP serves to guide you through the
code as well as to expose any misunderstandings I may have about
HTTP (so you don't need to read the code to figure out I'm wrong
:-).</p>

<p>HTTP (HyperText Transfer Protocol) is an extensible protocol on
top of a reliable stream transport (e.g. TCP/IP).  The protocol
recognizes three parts to a request:</p>

<ol>
<li>One line identifying the request type and path</li>
<li>An optional set of RFC-822-style headers</li>
<li>An optional data part</li>
</ol>

<p>The headers and data are separated by a blank line.</p>

<p>The first line of the request has the form</p>

<p><command> <path> <version></p>

<p>where <command> is a (case-sensitive) keyword such as GET or POST,
<path> is a string containing path information for the request,
and <version> should be the string "HTTP/1.0" or "HTTP/1.1".
<path> is encoded using the URL encoding scheme (using %xx to signify
the ASCII character with hex code xx).</p>

<p>The specification specifies that lines are separated by CRLF but
for compatibility with the widest range of clients recommends
servers also handle LF.  Similarly, whitespace in the request line
is treated sensibly (allowing multiple spaces between components
and allowing trailing whitespace).</p>

<p>Similarly, for output, lines ought to be separated by CRLF pairs
but most clients grok LF characters just fine.</p>

<p>If the first line of the request has the form</p>

<p><command> <path></p>

<p>(i.e. <version> is left out) then this is assumed to be an HTTP
0.9 request; this form has no optional headers and data part and
the reply consists of just the data.</p>

<p>The reply form of the HTTP 1.x protocol again has three parts:</p>

<ol>
<li>One line giving the response code</li>
<li>An optional set of RFC-822-style headers</li>
<li>The data</li>
</ol>

<p>Again, the headers and data are separated by a blank line.</p>

<p>The response code line has the form</p>

<p><version> <responsecode> <responsestring></p>

<p>where <version> is the protocol version ("HTTP/1.0" or "HTTP/1.1"),
<responsecode> is a 3-digit response code indicating success or
failure of the request, and <responsestring> is an optional
human-readable string explaining what the response code means.</p>

<p>This server parses the request and the headers, and then calls a
function specific to the request type (<command>).  Specifically,
a request SPAM will be handled by a method do_SPAM().  If no
such method exists the server sends an error response to the
client.  If it exists, it is called with no arguments:</p>

<p>do_SPAM()</p>

<p>Note that the request name is case sensitive (i.e. SPAM and spam
are different requests).</p>

<p>The various request details are stored in instance variables:</p>

<ul>
<li><p>client_address is the client IP address in the form (host,
port);</p></li>
<li><p>command, path and version are the broken-down request line;</p></li>
<li><p>headers is an instance of email.message.Message (or a derived
class) containing the header information;</p></li>
<li><p>rfile is a file object open for reading positioned at the
start of the optional input data part;</p></li>
<li><p>wfile is a file object open for writing.</p></li>
</ul>

<p>IT IS IMPORTANT TO ADHERE TO THE PROTOCOL FOR WRITING!</p>

<p>The first thing to be written must be the response line.  Then
follow 0 or more header lines, then a blank line, and then the
actual data (if any).  The meaning of the header lines depends on
the command executed by the server; in most cases, when data is
returned, there should be at least one header line of the form</p>

<p>Content-type: <type>/<subtype></p>

<p>where <type> and <subtype> should be registered MIME types,
e.g. "text/html" or "text/plain".</p>
</div>


                            <div id="DarkHandler.darkfream" class="classattr">
                                <div class="attr variable">
            <span class="name">darkfream</span>        =
<span class="default_value">None</span>


    </div>
    <a class="headerlink" href="#DarkHandler.darkfream"></a>



                            </div>
                            <div id="DarkHandler.initialize" class="classattr">
                                        <input id="DarkHandler.initialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">initialize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">darkfream</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkHandler.initialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkHandler.initialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkHandler.initialize-318"><a href="#DarkHandler.initialize-318"><span class="linenos">318</span></a>    <span class="nd">@classmethod</span>
</span><span id="DarkHandler.initialize-319"><a href="#DarkHandler.initialize-319"><span class="linenos">319</span></a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">darkfream</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DarkHandler.initialize-320"><a href="#DarkHandler.initialize-320"><span class="linenos">320</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Инициализирует DarkHandler с экземпляром DarkFream.</span>
</span><span id="DarkHandler.initialize-321"><a href="#DarkHandler.initialize-321"><span class="linenos">321</span></a>
</span><span id="DarkHandler.initialize-322"><a href="#DarkHandler.initialize-322"><span class="linenos">322</span></a><span class="sd">        Args:</span>
</span><span id="DarkHandler.initialize-323"><a href="#DarkHandler.initialize-323"><span class="linenos">323</span></a><span class="sd">            darkfream (DarkFream, optional): Экземпляр DarkFream. Если не указан, создается новый экземпляр.</span>
</span><span id="DarkHandler.initialize-324"><a href="#DarkHandler.initialize-324"><span class="linenos">324</span></a>
</span><span id="DarkHandler.initialize-325"><a href="#DarkHandler.initialize-325"><span class="linenos">325</span></a><span class="sd">        Returns:</span>
</span><span id="DarkHandler.initialize-326"><a href="#DarkHandler.initialize-326"><span class="linenos">326</span></a><span class="sd">            DarkFream: Экземпляр DarkFream, используемый в обработчике.</span>
</span><span id="DarkHandler.initialize-327"><a href="#DarkHandler.initialize-327"><span class="linenos">327</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkHandler.initialize-328"><a href="#DarkHandler.initialize-328"><span class="linenos">328</span></a>        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">darkfream</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DarkHandler.initialize-329"><a href="#DarkHandler.initialize-329"><span class="linenos">329</span></a>            <span class="k">if</span> <span class="n">darkfream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DarkHandler.initialize-330"><a href="#DarkHandler.initialize-330"><span class="linenos">330</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">darkfream</span> <span class="o">=</span> <span class="n">darkfream</span>
</span><span id="DarkHandler.initialize-331"><a href="#DarkHandler.initialize-331"><span class="linenos">331</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DarkHandler.initialize-332"><a href="#DarkHandler.initialize-332"><span class="linenos">332</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">darkfream</span> <span class="o">=</span> <span class="n">DarkFream</span><span class="p">()</span>
</span><span id="DarkHandler.initialize-333"><a href="#DarkHandler.initialize-333"><span class="linenos">333</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">darkfream</span>
</span></pre></div>


            <div class="docstring"><p>Инициализирует DarkHandler с экземпляром DarkFream.</p>

<p>Args:
    darkfream (DarkFream, optional): Экземпляр DarkFream. Если не указан, создается новый экземпляр.</p>

<p>Returns:
    DarkFream: Экземпляр DarkFream, используемый в обработчике.</p>
</div>


                            </div>
                            <div id="DarkHandler.do_POST" class="classattr">
                                        <input id="DarkHandler.do_POST-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">do_POST</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkHandler.do_POST-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkHandler.do_POST"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkHandler.do_POST-335"><a href="#DarkHandler.do_POST-335"><span class="linenos">335</span></a>    <span class="k">def</span> <span class="nf">do_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DarkHandler.do_POST-336"><a href="#DarkHandler.do_POST-336"><span class="linenos">336</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Обрабатывает HTTP POST запрос.</span>
</span><span id="DarkHandler.do_POST-337"><a href="#DarkHandler.do_POST-337"><span class="linenos">337</span></a>
</span><span id="DarkHandler.do_POST-338"><a href="#DarkHandler.do_POST-338"><span class="linenos">338</span></a><span class="sd">        Читает данные из запроса, обрабатывает их и возвращает ответ клиенту.</span>
</span><span id="DarkHandler.do_POST-339"><a href="#DarkHandler.do_POST-339"><span class="linenos">339</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkHandler.do_POST-340"><a href="#DarkHandler.do_POST-340"><span class="linenos">340</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DarkHandler.do_POST-341"><a href="#DarkHandler.do_POST-341"><span class="linenos">341</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="DarkHandler.do_POST-342"><a href="#DarkHandler.do_POST-342"><span class="linenos">342</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DarkHandler.do_POST-343"><a href="#DarkHandler.do_POST-343"><span class="linenos">343</span></a>            <span class="n">content_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">])</span>
</span><span id="DarkHandler.do_POST-344"><a href="#DarkHandler.do_POST-344"><span class="linenos">344</span></a>            <span class="n">post_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">content_length</span><span class="p">)</span>
</span><span id="DarkHandler.do_POST-345"><a href="#DarkHandler.do_POST-345"><span class="linenos">345</span></a>            <span class="n">content_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="DarkHandler.do_POST-346"><a href="#DarkHandler.do_POST-346"><span class="linenos">346</span></a>
</span><span id="DarkHandler.do_POST-347"><a href="#DarkHandler.do_POST-347"><span class="linenos">347</span></a>            <span class="k">if</span> <span class="s1">&#39;application/json&#39;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="DarkHandler.do_POST-348"><a href="#DarkHandler.do_POST-348"><span class="linenos">348</span></a>                <span class="kn">import</span> <span class="nn">json</span>
</span><span id="DarkHandler.do_POST-349"><a href="#DarkHandler.do_POST-349"><span class="linenos">349</span></a>                <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">post_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="DarkHandler.do_POST-350"><a href="#DarkHandler.do_POST-350"><span class="linenos">350</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DarkHandler.do_POST-351"><a href="#DarkHandler.do_POST-351"><span class="linenos">351</span></a>                <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">parse_qs</span><span class="p">(</span><span class="n">post_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="DarkHandler.do_POST-352"><a href="#DarkHandler.do_POST-352"><span class="linenos">352</span></a>
</span><span id="DarkHandler.do_POST-353"><a href="#DarkHandler.do_POST-353"><span class="linenos">353</span></a>            <span class="n">request_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DarkHandler.do_POST-354"><a href="#DarkHandler.do_POST-354"><span class="linenos">354</span></a>                <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span id="DarkHandler.do_POST-355"><a href="#DarkHandler.do_POST-355"><span class="linenos">355</span></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="DarkHandler.do_POST-356"><a href="#DarkHandler.do_POST-356"><span class="linenos">356</span></a>                <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">),</span>
</span><span id="DarkHandler.do_POST-357"><a href="#DarkHandler.do_POST-357"><span class="linenos">357</span></a>                <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">parsed_data</span><span class="p">,</span>
</span><span id="DarkHandler.do_POST-358"><a href="#DarkHandler.do_POST-358"><span class="linenos">358</span></a>                <span class="s1">&#39;session&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_session</span><span class="p">()</span>
</span><span id="DarkHandler.do_POST-359"><a href="#DarkHandler.do_POST-359"><span class="linenos">359</span></a>            <span class="p">}</span>
</span><span id="DarkHandler.do_POST-360"><a href="#DarkHandler.do_POST-360"><span class="linenos">360</span></a>
</span><span id="DarkHandler.do_POST-361"><a href="#DarkHandler.do_POST-361"><span class="linenos">361</span></a>            <span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">content_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">request_data</span><span class="p">)</span>
</span><span id="DarkHandler.do_POST-362"><a href="#DarkHandler.do_POST-362"><span class="linenos">362</span></a>
</span><span id="DarkHandler.do_POST-363"><a href="#DarkHandler.do_POST-363"><span class="linenos">363</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span>
</span><span id="DarkHandler.do_POST-364"><a href="#DarkHandler.do_POST-364"><span class="linenos">364</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DarkHandler.do_POST-365"><a href="#DarkHandler.do_POST-365"><span class="linenos">365</span></a>                <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">content_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DarkHandler.do_POST-366"><a href="#DarkHandler.do_POST-366"><span class="linenos">366</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="DarkHandler.do_POST-367"><a href="#DarkHandler.do_POST-367"><span class="linenos">367</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DarkHandler.do_POST-368"><a href="#DarkHandler.do_POST-368"><span class="linenos">368</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
</span><span id="DarkHandler.do_POST-369"><a href="#DarkHandler.do_POST-369"><span class="linenos">369</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</span><span id="DarkHandler.do_POST-370"><a href="#DarkHandler.do_POST-370"><span class="linenos">370</span></a>
</span><span id="DarkHandler.do_POST-371"><a href="#DarkHandler.do_POST-371"><span class="linenos">371</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;Location&#39;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span><span id="DarkHandler.do_POST-372"><a href="#DarkHandler.do_POST-372"><span class="linenos">372</span></a>                <span class="k">return</span>
</span><span id="DarkHandler.do_POST-373"><a href="#DarkHandler.do_POST-373"><span class="linenos">373</span></a>
</span><span id="DarkHandler.do_POST-374"><a href="#DarkHandler.do_POST-374"><span class="linenos">374</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="DarkHandler.do_POST-375"><a href="#DarkHandler.do_POST-375"><span class="linenos">375</span></a>
</span><span id="DarkHandler.do_POST-376"><a href="#DarkHandler.do_POST-376"><span class="linenos">376</span></a>        <span class="k">except</span> <span class="ne">ConnectionAbortedError</span><span class="p">:</span>
</span><span id="DarkHandler.do_POST-377"><a href="#DarkHandler.do_POST-377"><span class="linenos">377</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Client connection aborted&#39;</span><span class="p">)</span>
</span><span id="DarkHandler.do_POST-378"><a href="#DarkHandler.do_POST-378"><span class="linenos">378</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DarkHandler.do_POST-379"><a href="#DarkHandler.do_POST-379"><span class="linenos">379</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error handling POST request: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Обрабатывает HTTP POST запрос.</p>

<p>Читает данные из запроса, обрабатывает их и возвращает ответ клиенту.</p>
</div>


                            </div>
                            <div id="DarkHandler.do_OPTIONS" class="classattr">
                                        <input id="DarkHandler.do_OPTIONS-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">do_OPTIONS</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkHandler.do_OPTIONS-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkHandler.do_OPTIONS"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkHandler.do_OPTIONS-381"><a href="#DarkHandler.do_OPTIONS-381"><span class="linenos">381</span></a>    <span class="k">def</span> <span class="nf">do_OPTIONS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DarkHandler.do_OPTIONS-382"><a href="#DarkHandler.do_OPTIONS-382"><span class="linenos">382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Обрабатывает HTTP OPTIONS запрос.</span>
</span><span id="DarkHandler.do_OPTIONS-383"><a href="#DarkHandler.do_OPTIONS-383"><span class="linenos">383</span></a>
</span><span id="DarkHandler.do_OPTIONS-384"><a href="#DarkHandler.do_OPTIONS-384"><span class="linenos">384</span></a><span class="sd">        Возвращает заголовки, позволяющие клиентам узнать, какие методы поддерживаются сервером.</span>
</span><span id="DarkHandler.do_OPTIONS-385"><a href="#DarkHandler.do_OPTIONS-385"><span class="linenos">385</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkHandler.do_OPTIONS-386"><a href="#DarkHandler.do_OPTIONS-386"><span class="linenos">386</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DarkHandler.do_OPTIONS-387"><a href="#DarkHandler.do_OPTIONS-387"><span class="linenos">387</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="DarkHandler.do_OPTIONS-388"><a href="#DarkHandler.do_OPTIONS-388"><span class="linenos">388</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DarkHandler.do_OPTIONS-389"><a href="#DarkHandler.do_OPTIONS-389"><span class="linenos">389</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">204</span><span class="p">)</span>
</span><span id="DarkHandler.do_OPTIONS-390"><a href="#DarkHandler.do_OPTIONS-390"><span class="linenos">390</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="DarkHandler.do_OPTIONS-391"><a href="#DarkHandler.do_OPTIONS-391"><span class="linenos">391</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">,</span> <span class="s1">&#39;GET, POST, OPTIONS&#39;</span><span class="p">)</span>
</span><span id="DarkHandler.do_OPTIONS-392"><a href="#DarkHandler.do_OPTIONS-392"><span class="linenos">392</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">)</span>
</span><span id="DarkHandler.do_OPTIONS-393"><a href="#DarkHandler.do_OPTIONS-393"><span class="linenos">393</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Credentials&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span>
</span><span id="DarkHandler.do_OPTIONS-394"><a href="#DarkHandler.do_OPTIONS-394"><span class="linenos">394</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</span><span id="DarkHandler.do_OPTIONS-395"><a href="#DarkHandler.do_OPTIONS-395"><span class="linenos">395</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DarkHandler.do_OPTIONS-396"><a href="#DarkHandler.do_OPTIONS-396"><span class="linenos">396</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error handling OPTIONS request: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Обрабатывает HTTP OPTIONS запрос.</p>

<p>Возвращает заголовки, позволяющие клиентам узнать, какие методы поддерживаются сервером.</p>
</div>


                            </div>
                            <div id="DarkHandler.parse_session" class="classattr">
                                        <input id="DarkHandler.parse_session-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">parse_session</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkHandler.parse_session-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkHandler.parse_session"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkHandler.parse_session-398"><a href="#DarkHandler.parse_session-398"><span class="linenos">398</span></a>    <span class="k">def</span> <span class="nf">parse_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DarkHandler.parse_session-399"><a href="#DarkHandler.parse_session-399"><span class="linenos">399</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Парсит данные сессии из заголовка Cookie.</span>
</span><span id="DarkHandler.parse_session-400"><a href="#DarkHandler.parse_session-400"><span class="linenos">400</span></a>
</span><span id="DarkHandler.parse_session-401"><a href="#DarkHandler.parse_session-401"><span class="linenos">401</span></a><span class="sd">        Returns:</span>
</span><span id="DarkHandler.parse_session-402"><a href="#DarkHandler.parse_session-402"><span class="linenos">402</span></a><span class="sd">            dict: Данные сессии, если они существуют, иначе пустой словарь.</span>
</span><span id="DarkHandler.parse_session-403"><a href="#DarkHandler.parse_session-403"><span class="linenos">403</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkHandler.parse_session-404"><a href="#DarkHandler.parse_session-404"><span class="linenos">404</span></a>        <span class="n">session_cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Cookie&#39;</span><span class="p">)</span>
</span><span id="DarkHandler.parse_session-405"><a href="#DarkHandler.parse_session-405"><span class="linenos">405</span></a>        <span class="k">if</span> <span class="n">session_cookie</span><span class="p">:</span>
</span><span id="DarkHandler.parse_session-406"><a href="#DarkHandler.parse_session-406"><span class="linenos">406</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DarkHandler.parse_session-407"><a href="#DarkHandler.parse_session-407"><span class="linenos">407</span></a>                <span class="n">session_data</span> <span class="o">=</span> <span class="n">session_cookie</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;session=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DarkHandler.parse_session-408"><a href="#DarkHandler.parse_session-408"><span class="linenos">408</span></a>                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">session_data</span><span class="p">)</span>
</span><span id="DarkHandler.parse_session-409"><a href="#DarkHandler.parse_session-409"><span class="linenos">409</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="DarkHandler.parse_session-410"><a href="#DarkHandler.parse_session-410"><span class="linenos">410</span></a>                <span class="k">pass</span>
</span><span id="DarkHandler.parse_session-411"><a href="#DarkHandler.parse_session-411"><span class="linenos">411</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span></pre></div>


            <div class="docstring"><p>Парсит данные сессии из заголовка Cookie.</p>

<p>Returns:
    dict: Данные сессии, если они существуют, иначе пустой словарь.</p>
</div>


                            </div>
                            <div id="DarkHandler.do_GET" class="classattr">
                                        <input id="DarkHandler.do_GET-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">do_GET</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkHandler.do_GET-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkHandler.do_GET"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkHandler.do_GET-413"><a href="#DarkHandler.do_GET-413"><span class="linenos">413</span></a>    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DarkHandler.do_GET-414"><a href="#DarkHandler.do_GET-414"><span class="linenos">414</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Обрабатывает HTTP GET запрос.</span>
</span><span id="DarkHandler.do_GET-415"><a href="#DarkHandler.do_GET-415"><span class="linenos">415</span></a>
</span><span id="DarkHandler.do_GET-416"><a href="#DarkHandler.do_GET-416"><span class="linenos">416</span></a><span class="sd">        Возвращает ответ клиенту в зависимости от запрашиваемого ресурса.</span>
</span><span id="DarkHandler.do_GET-417"><a href="#DarkHandler.do_GET-417"><span class="linenos">417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkHandler.do_GET-418"><a href="#DarkHandler.do_GET-418"><span class="linenos">418</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DarkHandler.do_GET-419"><a href="#DarkHandler.do_GET-419"><span class="linenos">419</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="DarkHandler.do_GET-420"><a href="#DarkHandler.do_GET-420"><span class="linenos">420</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DarkHandler.do_GET-421"><a href="#DarkHandler.do_GET-421"><span class="linenos">421</span></a>            <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span><span class="o">.</span><span class="n">static_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DarkHandler.do_GET-422"><a href="#DarkHandler.do_GET-422"><span class="linenos">422</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
</span><span id="DarkHandler.do_GET-423"><a href="#DarkHandler.do_GET-423"><span class="linenos">423</span></a>                    <span class="n">content</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">content_type</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">Request</span><span class="p">({</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">},</span> <span class="kc">None</span><span class="p">))</span>
</span><span id="DarkHandler.do_GET-424"><a href="#DarkHandler.do_GET-424"><span class="linenos">424</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span>
</span><span id="DarkHandler.do_GET-425"><a href="#DarkHandler.do_GET-425"><span class="linenos">425</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
</span><span id="DarkHandler.do_GET-426"><a href="#DarkHandler.do_GET-426"><span class="linenos">426</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</span><span id="DarkHandler.do_GET-427"><a href="#DarkHandler.do_GET-427"><span class="linenos">427</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DarkHandler.do_GET-428"><a href="#DarkHandler.do_GET-428"><span class="linenos">428</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="DarkHandler.do_GET-429"><a href="#DarkHandler.do_GET-429"><span class="linenos">429</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DarkHandler.do_GET-430"><a href="#DarkHandler.do_GET-430"><span class="linenos">430</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="DarkHandler.do_GET-431"><a href="#DarkHandler.do_GET-431"><span class="linenos">431</span></a>                    <span class="k">return</span>
</span><span id="DarkHandler.do_GET-432"><a href="#DarkHandler.do_GET-432"><span class="linenos">432</span></a>
</span><span id="DarkHandler.do_GET-433"><a href="#DarkHandler.do_GET-433"><span class="linenos">433</span></a>            <span class="n">request_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DarkHandler.do_GET-434"><a href="#DarkHandler.do_GET-434"><span class="linenos">434</span></a>                <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
</span><span id="DarkHandler.do_GET-435"><a href="#DarkHandler.do_GET-435"><span class="linenos">435</span></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="DarkHandler.do_GET-436"><a href="#DarkHandler.do_GET-436"><span class="linenos">436</span></a>                <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">),</span>
</span><span id="DarkHandler.do_GET-437"><a href="#DarkHandler.do_GET-437"><span class="linenos">437</span></a>                <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DarkHandler.do_GET-438"><a href="#DarkHandler.do_GET-438"><span class="linenos">438</span></a>                <span class="s1">&#39;session&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_session</span><span class="p">()</span>
</span><span id="DarkHandler.do_GET-439"><a href="#DarkHandler.do_GET-439"><span class="linenos">439</span></a>            <span class="p">}</span>
</span><span id="DarkHandler.do_GET-440"><a href="#DarkHandler.do_GET-440"><span class="linenos">440</span></a>
</span><span id="DarkHandler.do_GET-441"><a href="#DarkHandler.do_GET-441"><span class="linenos">441</span></a>            <span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">content_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">darkfream</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span>
</span><span id="DarkHandler.do_GET-442"><a href="#DarkHandler.do_GET-442"><span class="linenos">442</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">request_data</span><span class="p">)</span>
</span><span id="DarkHandler.do_GET-443"><a href="#DarkHandler.do_GET-443"><span class="linenos">443</span></a>
</span><span id="DarkHandler.do_GET-444"><a href="#DarkHandler.do_GET-444"><span class="linenos">444</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span>
</span><span id="DarkHandler.do_GET-445"><a href="#DarkHandler.do_GET-445"><span class="linenos">445</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DarkHandler.do_GET-446"><a href="#DarkHandler.do_GET-446"><span class="linenos">446</span></a>                <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">content_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DarkHandler.do_GET-447"><a href="#DarkHandler.do_GET-447"><span class="linenos">447</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="DarkHandler.do_GET-448"><a href="#DarkHandler.do_GET-448"><span class="linenos">448</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DarkHandler.do_GET-449"><a href="#DarkHandler.do_GET-449"><span class="linenos">449</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span>
</span><span id="DarkHandler.do_GET-450"><a href="#DarkHandler.do_GET-450"><span class="linenos">450</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DarkHandler.do_GET-451"><a href="#DarkHandler.do_GET-451"><span class="linenos">451</span></a>                <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">content_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DarkHandler.do_GET-452"><a href="#DarkHandler.do_GET-452"><span class="linenos">452</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="DarkHandler.do_GET-453"><a href="#DarkHandler.do_GET-453"><span class="linenos">453</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DarkHandler.do_GET-454"><a href="#DarkHandler.do_GET-454"><span class="linenos">454</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
</span><span id="DarkHandler.do_GET-455"><a href="#DarkHandler.do_GET-455"><span class="linenos">455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</span><span id="DarkHandler.do_GET-456"><a href="#DarkHandler.do_GET-456"><span class="linenos">456</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="DarkHandler.do_GET-457"><a href="#DarkHandler.do_GET-457"><span class="linenos">457</span></a>
</span><span id="DarkHandler.do_GET-458"><a href="#DarkHandler.do_GET-458"><span class="linenos">458</span></a>        <span class="k">except</span> <span class="ne">ConnectionAbortedError</span><span class="p">:</span>
</span><span id="DarkHandler.do_GET-459"><a href="#DarkHandler.do_GET-459"><span class="linenos">459</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Client connection aborted&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Обрабатывает HTTP GET запрос.</p>

<p>Возвращает ответ клиенту в зависимости от запрашиваемого ресурса.</p>
</div>


                            </div>
                            <div id="DarkHandler.log_message" class="classattr">
                                        <input id="DarkHandler.log_message-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">log_message</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="nb">format</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DarkHandler.log_message-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DarkHandler.log_message"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DarkHandler.log_message-461"><a href="#DarkHandler.log_message-461"><span class="linenos">461</span></a>    <span class="k">def</span> <span class="nf">log_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="DarkHandler.log_message-462"><a href="#DarkHandler.log_message-462"><span class="linenos">462</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Логирует сообщения о запросах.</span>
</span><span id="DarkHandler.log_message-463"><a href="#DarkHandler.log_message-463"><span class="linenos">463</span></a>
</span><span id="DarkHandler.log_message-464"><a href="#DarkHandler.log_message-464"><span class="linenos">464</span></a><span class="sd">        Args:</span>
</span><span id="DarkHandler.log_message-465"><a href="#DarkHandler.log_message-465"><span class="linenos">465</span></a><span class="sd">            format (str): Формат сообщения.</span>
</span><span id="DarkHandler.log_message-466"><a href="#DarkHandler.log_message-466"><span class="linenos">466</span></a><span class="sd">            *args: Дополнительные аргументы для форматирования сообщения.</span>
</span><span id="DarkHandler.log_message-467"><a href="#DarkHandler.log_message-467"><span class="linenos">467</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DarkHandler.log_message-468"><a href="#DarkHandler.log_message-468"><span class="linenos">468</span></a>        <span class="n">client_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X-Forwarded-For&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X-Real-IP&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="DarkHandler.log_message-469"><a href="#DarkHandler.log_message-469"><span class="linenos">469</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">client_ip</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> - - [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">log_date_time_string</span><span class="p">()</span><span class="si">}</span><span class="s1">] - %s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">format</span> <span class="o">%</span> <span class="n">args</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Логирует сообщения о запросах.</p>

<p>Args:
    format (str): Формат сообщения.
    *args: Дополнительные аргументы для форматирования сообщения.</p>
</div>


                            </div>
                </section>
                <section id="migrate">
                            <input id="migrate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">migrate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">models</span><span class="o">=</span><span class="p">[]</span>, </span><span class="param"><span class="n">custom_user_model</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">initial_admin_data</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="migrate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#migrate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="migrate-475"><a href="#migrate-475"><span class="linenos">475</span></a><span class="k">def</span> <span class="nf">migrate</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="p">[],</span> <span class="n">custom_user_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initial_admin_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="migrate-476"><a href="#migrate-476"><span class="linenos">476</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Мигрирует модели базы данных и создает начального администратора.</span>
</span><span id="migrate-477"><a href="#migrate-477"><span class="linenos">477</span></a>
</span><span id="migrate-478"><a href="#migrate-478"><span class="linenos">478</span></a><span class="sd">    Эта функция добавляет указанные модели в базу данных, настраивает пользовательскую модель пользователя,</span>
</span><span id="migrate-479"><a href="#migrate-479"><span class="linenos">479</span></a><span class="sd">    и создает начального администратора, если он еще не существует.</span>
</span><span id="migrate-480"><a href="#migrate-480"><span class="linenos">480</span></a>
</span><span id="migrate-481"><a href="#migrate-481"><span class="linenos">481</span></a><span class="sd">    Args:</span>
</span><span id="migrate-482"><a href="#migrate-482"><span class="linenos">482</span></a><span class="sd">        models (list, optional): Список моделей для миграции. По умолчанию пустой список.</span>
</span><span id="migrate-483"><a href="#migrate-483"><span class="linenos">483</span></a><span class="sd">        custom_user_model (type, optional): Пользовательская модель пользователя, которая должна наследоваться от User.</span>
</span><span id="migrate-484"><a href="#migrate-484"><span class="linenos">484</span></a><span class="sd">        initial_admin_data (dict, optional): Данные для создания начального администратора. Должны включать &#39;username&#39; и &#39;password&#39;.</span>
</span><span id="migrate-485"><a href="#migrate-485"><span class="linenos">485</span></a>
</span><span id="migrate-486"><a href="#migrate-486"><span class="linenos">486</span></a><span class="sd">    Raises:</span>
</span><span id="migrate-487"><a href="#migrate-487"><span class="linenos">487</span></a><span class="sd">        ValueError: Если custom_user_model не наследуется от User.</span>
</span><span id="migrate-488"><a href="#migrate-488"><span class="linenos">488</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="migrate-489"><a href="#migrate-489"><span class="linenos">489</span></a>    <span class="n">models</span> <span class="o">+=</span> <span class="p">[</span><span class="n">User</span> <span class="p">,</span> <span class="n">Session</span><span class="p">]</span>
</span><span id="migrate-490"><a href="#migrate-490"><span class="linenos">490</span></a>    <span class="k">if</span> <span class="n">custom_user_model</span><span class="p">:</span>
</span><span id="migrate-491"><a href="#migrate-491"><span class="linenos">491</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">custom_user_model</span><span class="p">,</span> <span class="n">User</span><span class="p">):</span>
</span><span id="migrate-492"><a href="#migrate-492"><span class="linenos">492</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Custom user model must inherit from User class&quot;</span><span class="p">)</span>
</span><span id="migrate-493"><a href="#migrate-493"><span class="linenos">493</span></a>        <span class="n">set_user_model</span><span class="p">(</span><span class="n">custom_user_model</span><span class="p">)</span>
</span><span id="migrate-494"><a href="#migrate-494"><span class="linenos">494</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting user model to:&quot;</span><span class="p">,</span> <span class="n">custom_user_model</span><span class="p">)</span>
</span><span id="migrate-495"><a href="#migrate-495"><span class="linenos">495</span></a>
</span><span id="migrate-496"><a href="#migrate-496"><span class="linenos">496</span></a>    <span class="n">user_model</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span> <span class="ow">or</span> <span class="n">User</span>
</span><span id="migrate-497"><a href="#migrate-497"><span class="linenos">497</span></a>    <span class="n">handler</span> <span class="o">=</span> <span class="n">get_handler</span><span class="p">()</span> <span class="ow">or</span> <span class="n">DarkHandler</span>
</span><span id="migrate-498"><a href="#migrate-498"><span class="linenos">498</span></a>    <span class="n">handler</span><span class="o">.</span><span class="n">darkfream</span><span class="o">.</span><span class="n">admin</span><span class="o">.</span><span class="n">register_model</span><span class="p">(</span><span class="n">user_model</span><span class="p">)</span>
</span><span id="migrate-499"><a href="#migrate-499"><span class="linenos">499</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Migrate user model:&quot;</span><span class="p">,</span> <span class="n">user_model</span><span class="p">)</span>
</span><span id="migrate-500"><a href="#migrate-500"><span class="linenos">500</span></a>
</span><span id="migrate-501"><a href="#migrate-501"><span class="linenos">501</span></a>    <span class="n">default_admin</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="migrate-502"><a href="#migrate-502"><span class="linenos">502</span></a>        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span>
</span><span id="migrate-503"><a href="#migrate-503"><span class="linenos">503</span></a>        <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span>
</span><span id="migrate-504"><a href="#migrate-504"><span class="linenos">504</span></a>        <span class="s1">&#39;is_admin&#39;</span><span class="p">:</span> <span class="kc">True</span>
</span><span id="migrate-505"><a href="#migrate-505"><span class="linenos">505</span></a>    <span class="p">}</span>
</span><span id="migrate-506"><a href="#migrate-506"><span class="linenos">506</span></a>
</span><span id="migrate-507"><a href="#migrate-507"><span class="linenos">507</span></a>    <span class="k">if</span> <span class="n">initial_admin_data</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">initial_admin_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="migrate-508"><a href="#migrate-508"><span class="linenos">508</span></a>        <span class="n">initial_admin_data</span><span class="p">[</span><span class="s1">&#39;is_admin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="migrate-509"><a href="#migrate-509"><span class="linenos">509</span></a>        <span class="k">if</span> <span class="s1">&#39;password&#39;</span> <span class="ow">in</span> <span class="n">initial_admin_data</span><span class="p">:</span>
</span><span id="migrate-510"><a href="#migrate-510"><span class="linenos">510</span></a>            <span class="n">password</span> <span class="o">=</span> <span class="n">initial_admin_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
</span><span id="migrate-511"><a href="#migrate-511"><span class="linenos">511</span></a>            <span class="n">default_admin</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">initial_admin_data</span><span class="p">)</span>
</span><span id="migrate-512"><a href="#migrate-512"><span class="linenos">512</span></a>            <span class="n">default_admin</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">password</span>
</span><span id="migrate-513"><a href="#migrate-513"><span class="linenos">513</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="migrate-514"><a href="#migrate-514"><span class="linenos">514</span></a>            <span class="n">default_admin</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">initial_admin_data</span><span class="p">)</span>
</span><span id="migrate-515"><a href="#migrate-515"><span class="linenos">515</span></a>
</span><span id="migrate-516"><a href="#migrate-516"><span class="linenos">516</span></a>    <span class="n">conn</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</span><span id="migrate-517"><a href="#migrate-517"><span class="linenos">517</span></a>    <span class="n">conn</span><span class="o">.</span><span class="n">create_tables</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
</span><span id="migrate-518"><a href="#migrate-518"><span class="linenos">518</span></a>
</span><span id="migrate-519"><a href="#migrate-519"><span class="linenos">519</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="migrate-520"><a href="#migrate-520"><span class="linenos">520</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_model</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="migrate-521"><a href="#migrate-521"><span class="linenos">521</span></a>            <span class="n">default_admin</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_model</span><span class="o">.</span><span class="n">hash_password</span><span class="p">(</span><span class="n">default_admin</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
</span><span id="migrate-522"><a href="#migrate-522"><span class="linenos">522</span></a>            <span class="n">user_model</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">default_admin</span><span class="p">)</span>
</span><span id="migrate-523"><a href="#migrate-523"><span class="linenos">523</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created admin user: </span><span class="si">{</span><span class="n">default_admin</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="migrate-524"><a href="#migrate-524"><span class="linenos">524</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="migrate-525"><a href="#migrate-525"><span class="linenos">525</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating admin user: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="migrate-526"><a href="#migrate-526"><span class="linenos">526</span></a>        <span class="k">raise</span>
</span><span id="migrate-527"><a href="#migrate-527"><span class="linenos">527</span></a>    <span class="k">finally</span><span class="p">:</span>
</span><span id="migrate-528"><a href="#migrate-528"><span class="linenos">528</span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Мигрирует модели базы данных и создает начального администратора.</p>

<p>Эта функция добавляет указанные модели в базу данных, настраивает пользовательскую модель пользователя,
и создает начального администратора, если он еще не существует.</p>

<p>Args:
    models (list, optional): Список моделей для миграции. По умолчанию пустой список.
    custom_user_model (type, optional): Пользовательская модель пользователя, которая должна наследоваться от User.
    initial_admin_data (dict, optional): Данные для создания начального администратора. Должны включать 'username' и 'password'.</p>

<p>Raises:
    ValueError: Если custom_user_model не наследуется от User.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>
